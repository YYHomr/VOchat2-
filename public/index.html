<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>VOChat 2</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <!-- PDF.js for advanced PDF text extraction -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <!-- Client-side document generation libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <!-- Machine learning libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
  <!-- TensorFlow.js for machine learning -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <!-- Tesseract.js for OCR -->
  <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>
  <!-- PptxGenJS for PowerPoint generation -->
  <script src="https://unpkg.com/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
  <style>
    :root {
      /* Formal Color Palette - Minimal and Professional */
      --primary-50: #f8f9fa;
      --primary-100: #f1f3f4;
      --primary-200: #e8eaed;
      --primary-300: #dadce0;
      --primary-400: #bdc1c6;
      --primary-500: #9aa0a6;
      --primary-600: #80868b;
      --primary-700: #5f6368;
      --primary-800: #3c4043;
      --primary-900: #202124;
      
      /* Neutral Grays - Professional Palette */
      --gray-50: #fafafa;
      --gray-100: #f5f5f5;
      --gray-200: #eeeeee;
      --gray-300: #e0e0e0;
      --gray-400: #bdbdbd;
      --gray-500: #9e9e9e;
      --gray-600: #757575;
      --gray-700: #616161;
      --gray-800: #424242;
      --gray-900: #212121;
      
      /* Dark Theme - Formal */
      --dark-bg-primary: #1a1a1a;
      --dark-bg-secondary: #2d2d2d;
      --dark-bg-tertiary: #3a3a3a;
      --dark-surface: #404040;
      --dark-surface-hover: #4a4a4a;
      --dark-surface-active: #525252;
      
      /* Enhanced User Message Colors */
      --user-primary: #000000;
      --user-primary-hover: #333333;
      --user-gradient-start: #000000;
      --user-gradient-end: #333333;
      
      /* Minimal Accent Colors */
      --accent-primary: #000000;
      --accent-primary-hover: #333333;
      --accent-success: #137333;
      --accent-warning: #ea8600;
      --accent-error: #d93025;
      
      /* Spacing Scale */
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      --space-10: 2.5rem;
      --space-12: 3rem;
      --space-16: 4rem;
      
      /* Border Radius - Subtle */
      --radius-xs: 0.125rem;
      --radius-sm: 0.25rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --radius-xl: 0.75rem;
      --radius-2xl: 1rem;
      
      /* Shadows - Subtle and Professional */
      --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      
      /* Typography */
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      
      /* Line Heights */
      --leading-tight: 1.25;
      --leading-normal: 1.5;
      --leading-relaxed: 1.625;
      
      /* Transitions - Subtle */
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 350ms ease;
      
      /* Z-Index Scale */
      --z-dropdown: 50;
      --z-sticky: 60;
      --z-fixed: 70;
      --z-modal: 90;
      --z-tooltip: 100;
      --z-welcome: 110;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: var(--font-size-base);
      line-height: var(--leading-normal);
      background: var(--gray-50);
      color: var(--gray-900);
      height: 100vh;
      display: grid;
      grid-template-columns: auto 1fr;
      grid-template-rows: auto 1fr auto;
      grid-template-areas: 
        "sidebar header"
        "sidebar main"
        "sidebar input";
      transition: all var(--transition-normal);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body.dark {
      background: var(--dark-bg-primary);
      color: var(--gray-100);
    }

    /* Mobile App Download Banner */
    .mobile-app-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-primary-hover));
      color: white;
      padding: var(--space-3) var(--space-4);
      display: none;
      align-items: center;
      justify-content: space-between;
      z-index: 100;
      box-shadow: var(--shadow-md);
    }

    .mobile-app-banner.show {
      display: flex;
    }

    .banner-content {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      flex: 1;
    }

    .banner-text {
      font-size: var(--font-size-sm);
      font-weight: 500;
    }

    .download-app-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-lg);
      padding: var(--space-2) var(--space-4);
      color: white;
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .download-app-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .banner-close {
      background: none;
      border: none;
      color: white;
      font-size: var(--font-size-lg);
      cursor: pointer;
      padding: var(--space-1);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .banner-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Header Styles - Made Smaller */
    .header {
      grid-area: header;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-3) var(--space-6);
      background: transparent;
      border-bottom: none;
      position: relative;
      z-index: var(--z-sticky);
      height: 60px;
    }

    body.dark .header {
      background: transparent;
      border-bottom: none;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .sidebar-toggle {
      background: none;
      border: none;
      color: inherit;
      font-size: var(--font-size-lg);
      cursor: pointer;
      padding: var(--space-2);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-toggle:hover {
      background: var(--gray-100);
    }

    body.dark .sidebar-toggle:hover {
      background: var(--dark-surface);
    }

    .header-title {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--gray-900);
      letter-spacing: -0.025em;
    }

    body.dark .header-title {
      color: var(--gray-100);
    }

    /* Conversation Name Display */
    .conversation-name {
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--gray-600);
      margin-left: var(--space-4);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    body.dark .conversation-name {
      color: var(--gray-400);
    }

    /* New Model Selector with Hover Text */
    .model-selector {
      position: relative;
      display: flex;
      align-items: center;
    }

    .model-buttons {
      display: flex;
      align-items: center;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    body.dark .model-buttons {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
    }

    .model-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      color: var(--gray-700);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      background: transparent;
      position: relative;
    }

    body.dark .model-button {
      color: var(--gray-300);
    }

    .model-button:hover {
      background: var(--gray-100);
    }

    body.dark .model-button:hover {
      background: var(--dark-surface-hover);
    }

    .model-button.active {
      background: var(--accent-primary);
      color: white;
    }

    .model-button.active:hover {
      background: var(--accent-primary-hover);
    }

    /* Model Button Tooltips */
    .model-button .tooltip {
      position: absolute;
      top: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: var(--gray-800);
      color: white;
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-md);
      font-size: var(--font-size-xs);
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-fast);
      z-index: var(--z-tooltip);
      pointer-events: none;
      box-shadow: var(--shadow-lg);
    }

    .model-button .tooltip::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 5px;
      border-style: solid;
      border-color: transparent transparent var(--gray-800) transparent;
    }

    .model-button:hover .tooltip {
      opacity: 1;
      visibility: visible;
    }

    body.dark .model-button .tooltip {
      background: var(--gray-900);
    }

    body.dark .model-button .tooltip::before {
      border-color: transparent transparent var(--gray-900) transparent;
    }

    /* Enhanced Sidebar Styles with Shrinking/Expanding and Adjustable Width */
    .sidebar {
      grid-area: sidebar;
      width: 320px;
      min-width: 60px;
      max-width: 500px;
      background: white;
      border-right: 1px solid var(--gray-200);
      display: flex;
      flex-direction: column;
      transition: all var(--transition-normal);
      position: relative;
      z-index: var(--z-fixed);
      overflow: hidden;
      resize: horizontal;
    }

    body.dark .sidebar {
      background: var(--dark-bg-secondary);
      border-right-color: var(--dark-surface);
    }

    .sidebar.collapsed {
      width: 60px !important;
      resize: none;
    }

    .sidebar.collapsed .sidebar-content,
    .sidebar.collapsed .sidebar-header .sidebar-title,
    .sidebar.collapsed .sidebar-header .sidebar-actions {
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-fast), visibility var(--transition-fast);
    }

    .sidebar.collapsed .sidebar-toggle-desktop {
      transform: rotate(180deg);
    }

    /* Collapsed Sidebar Icons */
    .sidebar.collapsed .sidebar-icons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-4);
      padding: var(--space-4) 0;
      opacity: 1;
      visibility: visible;
    }

    .sidebar-icons {
      display: none;
      position: absolute;
      top: 80px;
      left: 0;
      right: 0;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-fast), visibility var(--transition-fast);
    }

    .sidebar-icon {
      width: 40px;
      height: 40px;
      background: var(--gray-100);
      border: none;
      border-radius: var(--radius-lg);
      color: var(--gray-600);
      font-size: var(--font-size-base);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    body.dark .sidebar-icon {
      background: var(--dark-surface);
      color: var(--gray-400);
    }

    .sidebar-icon:hover {
      background: var(--accent-primary);
      color: white;
      transform: scale(1.05);
    }

    .sidebar-icon.active {
      background: var(--accent-primary);
      color: white;
    }

    .sidebar-header {
      padding: var(--space-4) var(--space-6) var(--space-3);
      border-bottom: 1px solid var(--gray-200);
      position: relative;
    }

    body.dark .sidebar-header {
      border-bottom-color: var(--dark-surface);
    }

    /* Popup Modal Styles */
    .popup-modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: var(--z-modal); /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
      align-items: center;
      justify-content: center;
    }

    .popup-modal.show {
      display: flex;
    }

    .popup-modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 0;
      border: 1px solid #888;
      width: 80%;
      max-width: 700px;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
      animation-name: animatetop;
      animation-duration: 0.4s;
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    @keyframes animatetop {
      from {top: -300px; opacity: 0}
      to {top: 0; opacity: 1}
    }

    .popup-modal-content img {
      width: 100%;
      height: auto;
      display: block;
    }

    .popup-modal-close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: rgba(255,255,255,0.7);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .popup-modal-close:hover,
    .popup-modal-close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    .sidebar-toggle-desktop {
      position: absolute;
      top: var(--space-4);
      right: var(--space-4);
      background: none;
      border: none;
      color: var(--gray-600);
      font-size: var(--font-size-sm);
      cursor: pointer;
      padding: var(--space-1);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
    }

    body.dark .sidebar-toggle-desktop {
      color: var(--gray-400);
    }

    .sidebar-toggle-desktop:hover {
      background: var(--gray-100);
      color: var(--gray-800);
    }

    body.dark .sidebar-toggle-desktop:hover {
      background: var(--dark-surface);
      color: var(--gray-200);
    }

    .sidebar-title {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      transition: opacity var(--transition-fast), visibility var(--transition-fast);
    }

    body.dark .sidebar-title {
      color: var(--gray-200);
    }

    .sidebar-title i {
      font-size: var(--font-size-base);
      color: var(--gray-600);
    }

    body.dark .sidebar-title i {
      color: var(--gray-400);
    }

    .sidebar-actions {
      display: flex;
      gap: var(--space-2);
      transition: opacity var(--transition-fast), visibility var(--transition-fast);
    }

    .sidebar-button {
      flex: 1;
      background: var(--accent-primary);
      border: none;
      border-radius: var(--radius-lg);
      padding: var(--space-3) var(--space-4);
      color: white;
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
    }

    .sidebar-button:hover {
      background: var(--accent-primary-hover);
    }

    .sidebar-button.secondary {
      background: var(--gray-100);
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
    }

    body.dark .sidebar-button.secondary {
      background: var(--dark-surface);
      color: var(--gray-300);
      border-color: var(--dark-surface-hover);
    }

    .sidebar-button.secondary:hover {
      background: var(--gray-200);
      border-color: var(--gray-400);
    }

    body.dark .sidebar-button.secondary:hover {
      background: var(--dark-surface-hover);
      border-color: var(--gray-600);
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-5) var(--space-6);
      transition: opacity var(--transition-fast), visibility var(--transition-fast);
    }

    .memory-section {
      margin-bottom: var(--space-8);
    }

    .section-title {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: var(--space-4);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    body.dark .section-title {
      color: var(--gray-300);
    }

    .memory-textarea {
      width: 100%;
      min-height: 100px;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: 1.5rem;
      padding: var(--space-4) var(--space-6);
      color: var(--gray-900);
      font-family: inherit;
      font-size: var(--font-size-sm);
      line-height: var(--leading-relaxed);
      resize: vertical;
      transition: all var(--transition-fast);
    }

    body.dark .memory-textarea {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
      color: var(--gray-100);
    }

    .memory-textarea:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .memory-textarea::placeholder {
      color: var(--gray-500);
    }

    .memory-actions {
      display: flex;
      gap: var(--space-2);
      margin-top: var(--space-4);
    }

    .history-section {
      flex: 1;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-3) var(--space-4);
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    body.dark .history-item {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
    }

    .history-item:hover {
      background: var(--gray-50);
      border-color: var(--gray-300);
    }

    body.dark .history-item:hover {
      background: var(--dark-surface-hover);
      border-color: var(--gray-600);
    }

    .history-item.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: white;
    }

    .history-text {
      flex: 1;
      font-size: var(--font-size-sm);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-weight: 500;
    }

    .history-delete {
      background: none;
      border: none;
      color: var(--accent-error);
      font-size: var(--font-size-sm);
      cursor: pointer;
      padding: var(--space-1);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      opacity: 0.7;
    }

    .history-delete:hover {
      opacity: 1;
      background: rgba(217, 48, 37, 0.1);
    }

    /* Main Chat Area */
    .main-content {
      grid-area: main;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      background: var(--gray-50);
    }

    body.dark .main-content {
      background: var(--dark-bg-primary);
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-8);
      scroll-behavior: smooth;
    }

    .chat-messages {
      display: flex;
      flex-direction: column;
      gap: var(--space-6);
      max-width: 800px;
      margin: 0 auto;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      color: var(--gray-500);
    }

    .empty-state-icon {
      font-size: var(--font-size-3xl);
      margin-bottom: var(--space-4);
      color: var(--gray-400);
    }

    .empty-state-title {
      font-size: var(--font-size-2xl);
      font-weight: 600;
      margin-bottom: var(--space-2);
      color: var(--gray-800);
    }

    body.dark .empty-state-title {
      color: var(--gray-200);
    }

    .empty-state-subtitle {
      font-size: var(--font-size-lg);
      margin-bottom: var(--space-6);
      color: var(--gray-600);
    }

    body.dark .empty-state-subtitle {
      color: var(--gray-400);
    }

    .start-button {
      background: var(--accent-primary);
      border: none;
      border-radius: var(--radius-xl);
      padding: var(--space-4) var(--space-8);
      color: white;
      font-size: var(--font-size-base);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-6);
    }

    .start-button:hover {
      background: var(--accent-primary-hover);
      box-shadow: var(--shadow-md);
    }

    /* Conversation Starters */
    .conversation-starters {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
      max-width: 600px;
      margin: 0 auto;
    }

    .conversation-starters h3 {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: var(--space-2);
      text-align: center;
    }

    body.dark .conversation-starters h3 {
      color: var(--gray-300);
    }

    .starter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-3);
    }

    .starter-item {
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: 1.5rem;
      padding: var(--space-4) var(--space-6);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: left;
    }

    body.dark .starter-item {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
    }

    .starter-item:hover {
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .starter-item h4 {
      font-size: var(--font-size-base);
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    body.dark .starter-item h4 {
      color: var(--gray-200);
    }

    .starter-item p {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      line-height: var(--leading-relaxed);
    }

    body.dark .starter-item p {
      color: var(--gray-400);
    }

    /* PowerPoint Starter Special Styling */
    .powerpoint-starter {
      background: linear-gradient(135deg, #ff6b35, #f7931e);
      border: none;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .powerpoint-starter h4 {
      color: white;
      font-weight: 700;
    }

    .powerpoint-starter p {
      color: rgba(255, 255, 255, 0.9);
    }

    .powerpoint-starter:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
      border-color: transparent;
    }

    body.dark .powerpoint-starter {
      background: linear-gradient(135deg, #ff6b35, #f7931e);
    }

    /* Starter Image Styling */
    .starter-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: var(--radius-lg);
      margin-top: var(--space-3);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-fast);
    }

    .powerpoint-starter .starter-image {
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .powerpoint-starter:hover .starter-image {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    /* PowerPoint Modal Styling */
    .powerpoint-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-normal);
    }

    .powerpoint-modal.show {
      opacity: 1;
      visibility: visible;
    }

    .powerpoint-modal-content {
      background: white;
      border-radius: var(--radius-xl);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      transform: scale(0.9);
      transition: all var(--transition-normal);
    }

    .powerpoint-modal.show .powerpoint-modal-content {
      transform: scale(1);
    }

    body.dark .powerpoint-modal-content {
      background: var(--dark-bg-secondary);
      border: 1px solid var(--dark-surface-hover);
    }

    .powerpoint-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-6);
      border-bottom: 1px solid var(--gray-200);
    }

    body.dark .powerpoint-modal-header {
      border-bottom-color: var(--dark-surface-hover);
    }

    .powerpoint-modal-header h3 {
      margin: 0;
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--gray-900);
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    body.dark .powerpoint-modal-header h3 {
      color: var(--gray-100);
    }

    .powerpoint-modal-close {
      background: none;
      border: none;
      color: var(--gray-500);
      font-size: var(--font-size-lg);
      cursor: pointer;
      padding: var(--space-2);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .powerpoint-modal-close:hover {
      background: var(--gray-100);
      color: var(--gray-700);
    }

    body.dark .powerpoint-modal-close:hover {
      background: var(--dark-surface-hover);
      color: var(--gray-300);
    }

    .powerpoint-modal-body {
      padding: var(--space-6);
    }

    .powerpoint-form {
      display: flex;
      flex-direction: column;
      gap: var(--space-5);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .form-group label {
      font-weight: 600;
      color: var(--gray-800);
      font-size: var(--font-size-sm);
    }

    body.dark .form-group label {
      color: var(--gray-200);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: var(--space-3);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-lg);
      font-size: var(--font-size-base);
      font-family: inherit;
      transition: all var(--transition-fast);
    }

    body.dark .form-group input,
    body.dark .form-group select,
    body.dark .form-group textarea {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
      color: var(--gray-200);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .powerpoint-modal-footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: var(--space-3);
      padding: var(--space-6);
      border-top: 1px solid var(--gray-200);
    }

    body.dark .powerpoint-modal-footer {
      border-top-color: var(--dark-surface-hover);
    }

    .powerpoint-btn-primary,
    .powerpoint-btn-secondary {
      padding: var(--space-3) var(--space-6);
      border-radius: var(--radius-lg);
      font-size: var(--font-size-base);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      border: none;
    }

    .powerpoint-btn-primary {
      background: linear-gradient(135deg, #ff6b35, #f7931e);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .powerpoint-btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .powerpoint-btn-secondary {
      background: var(--gray-100);
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
    }

    .powerpoint-btn-secondary:hover {
      background: var(--gray-200);
    }

    body.dark .powerpoint-btn-secondary {
      background: var(--dark-surface);
      color: var(--gray-300);
      border-color: var(--dark-surface-hover);
    }

    body.dark .powerpoint-btn-secondary:hover {
      background: var(--dark-surface-hover);
    }

    /* Enhanced Message Styles */
    .message {
      display: flex;
      gap: var(--space-3);
      max-width: 100%;
      margin-bottom: var(--space-4);
      position: relative;
    }

    .message.user {
      flex-direction: row-reverse;
      margin-left: auto;
      max-width: 75%;
    }

    .message.bot {
      max-width: 90%;
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-xl);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-base);
      font-weight: 600;
      flex-shrink: 0;
    }

    /* Enhanced User Message Avatar */
    .message.user .message-avatar {
      background: linear-gradient(135deg, var(--user-gradient-start), var(--user-gradient-end));
      color: white;
      box-shadow: var(--shadow-md);
      border: 2px solid white;
    }

    body.dark .message.user .message-avatar {
      border-color: var(--dark-bg-primary);
    }

    /* Minimal Bot Message Avatar */
    .message.bot .message-avatar {
      background: var(--gray-100);
      color: var(--gray-600);
      border: 1px solid var(--gray-200);
    }

    body.dark .message.bot .message-avatar {
      background: var(--dark-surface);
      color: var(--gray-400);
      border-color: var(--dark-surface-hover);
    }

    .message-content {
      flex: 1;
      min-width: 0;
    }

    /* Enhanced User Message Bubble */
    .message.user .message-bubble {
      background: var(--gray-800);
      color: var(--gray-100);
      border: none;
      border-radius: 1.5rem;
      padding: var(--space-4) var(--space-6);
      box-shadow: var(--shadow-sm);
      position: relative;
      word-wrap: break-word;
      line-height: var(--leading-relaxed);
      font-weight: 500;
    }

    .message.user .message-bubble::before {
      content: none;
    }

    /* AI Message - Enhanced with Better Paragraph Organization */
    .message.bot .message-bubble {
      background: none;
      border: none;
      border-radius: 0;
      padding: 0;
      box-shadow: none;
      word-wrap: break-word;
      line-height: var(--leading-relaxed);
      color: var(--gray-800);
      text-align: left;
    }

    body.dark .message.bot .message-bubble {
      color: var(--gray-200);
    }

    /* Enhanced Paragraph Styling for AI Messages */
    .message.bot .message-bubble p {
      margin: 0 0 var(--space-4) 0;
      line-height: 1.7;
      font-size: var(--font-size-base);
      color: inherit;
      text-align: left;
      word-spacing: 0.05em;
      letter-spacing: 0.01em;
    }

    .message.bot .message-bubble p:last-child {
      margin-bottom: 0;
    }

    /* Visual Dividers for Long Content - REMOVED */

    /* Enhanced Typography for Better Readability */
    .message.bot .message-bubble strong,
    .message.bot .message-bubble b {
      font-weight: 600;
      color: var(--gray-900);
    }

    body.dark .message.bot .message-bubble strong,
    body.dark .message.bot .message-bubble b {
      color: var(--gray-100);
    }

    /* Section Dividers for Major Content Breaks - REMOVED */

    /* Enhanced User Message Meta */
    .message.user .message-meta {
      font-size: var(--font-size-xs);
      color: var(--gray-400);
      margin-top: var(--space-2);
      font-weight: 500;
      text-align: right;
    }

    body.dark .message.user .message-meta {
      color: var(--gray-500);
    }

    /* Bot Message Meta - Minimal */
    .message.bot .message-meta {
      font-size: var(--font-size-xs);
      color: var(--gray-500);
      margin-top: var(--space-2);
      font-weight: 400;
    }

    body.dark .message.bot .message-meta {
      color: var(--gray-600);
    }

    /* User Message Action Buttons */
    .user-message-actions {
      position: absolute;
      bottom: -30px;
      right: 0;
      display: flex;
      gap: var(--space-2);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-fast);
      z-index: 10;
    }

    .message.user:hover .user-message-actions {
      opacity: 1;
      visibility: visible;
    }

    .user-message-action {
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-md);
      padding: var(--space-1) var(--space-2);
      color: var(--gray-600);
      font-size: var(--font-size-xs);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    body.dark .user-message-action {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
      color: var(--gray-400);
    }

    .user-message-action:hover {
      background: var(--gray-100);
      color: var(--gray-800);
      border-color: var(--gray-400);
    }

    body.dark .user-message-action:hover {
      background: var(--dark-surface-hover);
      color: var(--gray-200);
      border-color: var(--gray-600);
    }

    /* Bot Message Copy Button */
    .bot-message-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--space-2);
      gap: var(--space-2);
    }

    .bot-message-action {
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-md);
      padding: var(--space-1) var(--space-2);
      color: var(--gray-600);
      font-size: var(--font-size-xs);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    body.dark .bot-message-action {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
      color: var(--gray-400);
    }

    .bot-message-action:hover {
      background: var(--gray-100);
      color: var(--gray-800);
      border-color: var(--gray-400);
    }

    body.dark .bot-message-action:hover {
      background: var(--dark-surface-hover);
      color: var(--gray-200);
      border-color: var(--gray-600);
    }

    /* Code Block Styles - Enhanced for Bot Messages */
    .code-block {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      border-radius: 1.5rem;
      padding: var(--space-4) var(--space-6);
      margin: var(--space-3) 0;
      overflow-x: auto;
      position: relative;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--font-size-sm);
      line-height: var(--leading-normal);
    }

    body.dark .code-block {
      background: var(--dark-bg-primary);
      border-color: var(--dark-surface);
      color: var(--gray-300);
    }

    .code-block-actions {
      position: absolute;
      top: var(--space-2);
      right: var(--space-2);
      display: flex;
      gap: var(--space-2);
    }

    .code-action {
      background: var(--accent-primary);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-1) var(--space-2);
      color: white;
      font-size: var(--font-size-xs);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .code-action:hover {
      background: var(--accent-primary-hover);
    }

    /* Table Styles with Download Button */
    .table-container {
      position: relative;
      margin: 0 0 var(--space-2) 0;
      overflow-x: auto;
    }

    .table-actions {
      position: absolute;
      top: var(--space-1);
      right: var(--space-2);
      display: flex;
      gap: var(--space-2);
      z-index: 10;
    }

    .table-action {
      background: var(--accent-primary);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-1) var(--space-2);
      color: white;
      font-size: var(--font-size-xs);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .table-action:hover {
      background: var(--accent-primary-hover);
    }

    .message-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-sm);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .message-table th {
      background-color: var(--gray-200);
      color: var(--gray-800);
      font-weight: 600;
      text-align: left;
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--gray-300);
    }

    body.dark .message-table th {
      background-color: var(--dark-surface);
      color: var(--gray-200);
      border-color: var(--dark-surface-hover);
    }

    .message-table td {
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--gray-300);
      background-color: white;
    }

    body.dark .message-table td {
      background-color: var(--dark-bg-secondary);
      border-color: var(--dark-surface-hover);
      color: var(--gray-300);
    }

    .message-table tr:nth-child(even) td {
      background-color: var(--gray-50);
    }

    body.dark .message-table tr:nth-child(even) td {
      background-color: var(--dark-bg-tertiary);
    }

    /* Expandable Box for Analyzed Text */
    .expandable-box {
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-top: var(--space-3);
      margin-bottom: var(--space-3);
      position: relative;
      overflow: hidden;
    }

    body.dark .expandable-box {
      background: var(--dark-bg-secondary);
      border-color: var(--dark-surface-hover);
    }

    .expandable-box-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-weight: 600;
      color: var(--gray-800);
    }

    body.dark .expandable-box-header {
      color: var(--gray-200);
    }

    .expandable-box-header i {
      transition: transform var(--transition-fast);
    }

    .expandable-box-header.expanded i {
      transform: rotate(90deg);
    }

    .expandable-box-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      color: var(--gray-700);
      margin-top: var(--space-3);
    }

    body.dark .expandable-box-content {
      color: var(--gray-300);
    }

    .expandable-box-content.expanded {
      max-height: 1000px; /* Adjust as needed for content height */
      transition: max-height 0.5s ease-in;
    }

    /* Floating Input Area - No Background */
    .input-area {
      grid-area: input;
      padding: var(--space-3) var(--space-4);
      background: transparent;
      border-top: none;
    }

    .input-container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid var(--gray-300);
      border-radius: 2rem;
      padding: var(--space-2) var(--space-3);
      transition: all var(--transition-fast);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-lg);
    }

    body.dark .input-wrapper {
      background: rgba(45, 45, 45, 0.95);
      border-color: var(--dark-surface-hover);
    }

    .input-wrapper:focus-within {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1), var(--shadow-lg);
    }

    .input-actions {
      display: flex;
      gap: var(--space-1);
    }

    .input-action {
      background: none;
      border: none;
      color: var(--gray-500);
      font-size: var(--font-size-lg);
      cursor: pointer;
      padding: var(--space-2);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .input-action:hover {
      color: var(--gray-700);
      background: var(--gray-100);
    }

    body.dark .input-action:hover {
      color: var(--gray-300);
      background: var(--dark-surface-hover);
    }

    .message-input {
      flex: 1;
      background: none;
      border: none;
      color: inherit;
      font-family: inherit;
      font-size: var(--font-size-base);
      line-height: var(--leading-normal);
      padding: var(--space-1) var(--space-2);
      resize: none;
      max-height: 120px;
      min-height: 24px;
    }

    .message-input:focus {
      outline: none;
    }

    .message-input::placeholder {
      color: var(--gray-500);
    }

    .send-button {
      background: linear-gradient(135deg, var(--user-gradient-start), var(--user-gradient-end));
      border: none;
      border-radius: var(--radius-xl);
      width: 32px;
      height: 32px;
      color: white;
      font-size: var(--font-size-base);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
    }

    .send-button:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .send-button:disabled {
      background: var(--gray-400);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Powered by Vendo text */
    .powered-by {
      text-align: center;
      font-size: var(--font-size-xs);
      color: var(--gray-500);
      margin-top: var(--space-2);
      padding: var(--space-1);
    }

    body.dark .powered-by {
      color: var(--gray-600);
    }

    .powered-by a {
      color: var(--accent-primary);
      text-decoration: none;
      font-weight: 500;
    }

    body.dark .powered-by a {
      color: var(--accent-primary);
    }

    /* Response Timer */
    .response-timer {
      display: inline-block;
      font-size: var(--font-size-xs);
      color: var(--gray-500);
      margin-left: var(--space-2);
    }

    body.dark .response-timer {
      color: var(--gray-600);
    }

    /* Enhanced File Upload Styles */
    .file-input {
      display: none;
    }

    .file-menu {
      position: absolute;
      bottom: calc(100% + var(--space-2));
      left: 0;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-lg);
      padding: var(--space-2);
      min-width: 250px;
      box-shadow: var(--shadow-lg);
      z-index: var(--z-dropdown);
      opacity: 0;
      visibility: hidden;
      transform: translateY(8px);
      transition: all var(--transition-fast);
    }

    body.dark .file-menu {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
    }

    .file-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .file-menu-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      width: 100%;
      background: none;
      border: none;
      color: inherit;
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: left;
      font-size: var(--font-size-sm);
    }

    .file-menu-item:hover {
      background: var(--gray-100);
    }

    body.dark .file-menu-item:hover {
      background: var(--dark-surface-hover);
    }

    .file-menu-item i {
      width: 16px;
      text-align: center;
    }

    /* Right-side Code View Panel */
    .code-view-panel {
      position: fixed;
      top: 0;
      right: -50%;
      width: 50%;
      height: 100vh;
      background: white;
      border-left: 1px solid var(--gray-300);
      z-index: 1000;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    }

    body.dark .code-view-panel {
      background: var(--dark-bg-secondary);
      border-left-color: var(--dark-surface-hover);
    }

    .code-view-panel.open {
      right: 0;
    }

    .code-view-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4);
      border-bottom: 1px solid var(--gray-300);
      background: var(--gray-50);
    }

    body.dark .code-view-header {
      background: var(--dark-surface);
      border-bottom-color: var(--dark-surface-hover);
    }

    .code-view-header h3 {
      margin: 0;
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--gray-900);
    }

    body.dark .code-view-header h3 {
      color: var(--gray-100);
    }

    .code-view-close {
      background: none;
      border: none;
      color: var(--gray-500);
      font-size: var(--font-size-lg);
      cursor: pointer;
      padding: var(--space-2);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .code-view-close:hover {
      background: var(--gray-200);
      color: var(--gray-700);
    }

    body.dark .code-view-close:hover {
      background: var(--dark-surface-hover);
      color: var(--gray-300);
    }

    .code-view-actions {
      display: flex;
      gap: var(--space-2);
      padding: var(--space-3);
      border-bottom: 1px solid var(--gray-300);
      background: var(--gray-50);
    }

    body.dark .code-view-actions {
      background: var(--dark-surface);
      border-bottom-color: var(--dark-surface-hover);
    }

    .code-view-action {
      background: var(--accent-primary);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-2) var(--space-3);
      color: white;
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .code-view-action:hover {
      background: var(--accent-primary-hover);
    }

    .code-view-content {
      flex: 1;
      overflow: auto;
      padding: var(--space-4);
    }

    .code-view-content pre {
      margin: 0;
      background: var(--gray-100);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      overflow: auto;
      font-family: 'Courier New', monospace;
      font-size: var(--font-size-sm);
      line-height: var(--leading-relaxed);
    }

    body.dark .code-view-content pre {
      background: var(--dark-bg-tertiary);
      color: var(--gray-300);
    }

    .code-view-output {
      padding: var(--space-4);
      border-top: 1px solid var(--gray-300);
      background: var(--gray-50);
    }

    body.dark .code-view-output {
      background: var(--dark-surface);
      border-top-color: var(--dark-surface-hover);
    }

    .code-view-output h4 {
      margin: 0 0 var(--space-2) 0;
      font-size: var(--font-size-base);
      font-weight: 600;
      color: var(--gray-900);
    }

    body.dark .code-view-output h4 {
      color: var(--gray-100);
    }

    .code-view-output pre {
      margin: 0;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-md);
      padding: var(--space-3);
      font-family: 'Courier New', monospace;
      font-size: var(--font-size-sm);
      color: var(--gray-800);
      max-height: 200px;
      overflow: auto;
    }

    body.dark .code-view-output pre {
      background: var(--dark-bg-tertiary);
      border-color: var(--dark-surface-hover);
      color: var(--gray-300);
    }

    /* Mobile responsiveness for code view */
    @media (max-width: 768px) {
      .code-view-panel {
        width: 100%;
        right: -100%;
      }
    }

    /* File Preview Styles */
    .file-preview {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin: var(--space-3) 0;
      position: relative;
    }

    body.dark .file-preview {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
    }

    .file-preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-3);
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    .file-icon {
      width: 40px;
      height: 40px;
      background: var(--accent-primary);
      color: white;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-lg);
    }

    .file-details h4 {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: var(--space-1);
    }

    body.dark .file-details h4 {
      color: var(--gray-200);
    }

    .file-details p {
      font-size: var(--font-size-xs);
      color: var(--gray-600);
    }

    body.dark .file-details p {
      color: var(--gray-400);
    }

    .file-actions {
      display: flex;
      gap: var(--space-2);
    }

    .file-action {
      background: var(--accent-primary);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-1) var(--space-2);
      color: white;
      font-size: var(--font-size-xs);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .file-action:hover {
      background: var(--accent-primary-hover);
    }

    .file-content {
      max-height: 300px;
      overflow-y: auto;
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-md);
      padding: var(--space-3);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--font-size-sm);
      line-height: var(--leading-normal);
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    body.dark .file-content {
      background: var(--dark-bg-primary);
      border-color: var(--dark-surface);
      color: var(--gray-300);
    }

    /* Image Preview Styles */
    .image-preview {
      max-width: 100%;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .image-preview:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-lg);
    }

    /* Enhanced Quick Replies */
    .quick-replies {
      display: flex;
      gap: var(--space-2);
      margin-top: var(--space-4);
      flex-wrap: wrap;
    }

    .quick-reply {
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-xl);
      padding: var(--space-2) var(--space-4);
      color: var(--gray-700);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    body.dark .quick-reply {
      background: var(--dark-surface);
      border-color: var(--dark-surface-hover);
      color: var(--gray-300);
    }

    .quick-reply:hover {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: white;
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* Image Grid */
    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-3);
      margin-top: var(--space-3);
    }

    .image-grid img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 1px solid var(--gray-200);
    }

    body.dark .image-grid img {
      border-color: var(--dark-surface);
    }

    .image-grid img:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-md);
    }

    /* Enhanced Responsive Design */
    @media (max-width: 1024px) {
      .sidebar {
        width: 280px;
        max-width: 280px;
      }
      
      .starter-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        grid-template-columns: 1fr;
        grid-template-areas: 
          "header"
          "main"
          "input";
      }

      body.mobile-banner-shown {
        padding-top: 60px;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: -320px;
        height: 100vh;
        z-index: var(--z-modal);
        box-shadow: var(--shadow-xl);
        width: 320px !important;
        max-width: 320px !important;
        resize: none;
      }

      .sidebar.show {
        left: 0;
      }

      .sidebar.collapsed {
        width: 320px !important;
      }

      .sidebar-toggle {
        display: block;
      }

      .sidebar-toggle-desktop {
        display: none;
      }

      .chat-container {
        padding: var(--space-4);
      }

      .input-area {
        padding: var(--space-4);
      }

      .header {
        padding: var(--space-4);
      }

      .message.user {
        max-width: 85%;
      }

      .message.bot {
        max-width: 95%;
      }

      .starter-grid {
        grid-template-columns: 1fr;
      }

      .starter-item {
        padding: var(--space-3);
      }
    }

    @media (max-width: 480px) {
      .header-title {
        font-size: var(--font-size-lg);
      }

      .model-button {
        min-width: 80px;
        padding: var(--space-2);
      }

      .model-button span {
        display: none;
      }

      .chat-container {
        padding: var(--space-3);
      }

      .input-area {
        padding: var(--space-3);
      }

      .message.user {
        max-width: 90%;
      }

      .message.bot {
        max-width: 100%;
      }
    }

    /* Scrollbar Styles */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--gray-400);
      border-radius: var(--radius-xl);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--gray-500);
    }

    body.dark ::-webkit-scrollbar-thumb {
      background: var(--gray-600);
    }

    body.dark ::-webkit-scrollbar-thumb:hover {
      background: var(--gray-500);
    }

    /* Loading States */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--gray-500);
      font-style: italic;
      padding: var(--space-2) 0;
    }

    .typing-dots {
      display: flex;
      gap: var(--space-1);
    }

    .typing-dot {
      width: 4px;
      height: 4px;
      background: var(--gray-500);
      border-radius: 50%;
      animation: typingDot 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typingDot {
      0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message {
      animation: fadeIn var(--transition-normal);
    }

    /* Focus States */
    *:focus-visible {
      outline: 2px solid var(--accent-primary);
      outline-offset: 2px;
    }

    /* Selection */
    ::selection {
      background: var(--accent-primary);
      color: white;
    }

    /* Touch-friendly improvements */
    @media (hover: none) and (pointer: coarse) {
      .sidebar-button,
      .start-button,
      .quick-reply,
      .starter-item {
        min-height: 44px;
      }

      .input-action,
      .send-button {
        min-width: 44px;
        min-height: 44px;
      }
    }

    /* Welcome Popup Styles */
    .welcome-popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-welcome);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-normal);
    }

    .welcome-popup-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .welcome-popup {
      background: white;
      border-radius: var(--radius-2xl);
      padding: var(--space-8);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      transform: scale(0.9) translateY(20px);
      transition: all var(--transition-normal);
      text-align: center;
    }

    body.dark .welcome-popup {
      background: var(--dark-bg-secondary);
      border: 1px solid var(--dark-surface);
    }

    .welcome-popup-overlay.show .welcome-popup {
      transform: scale(1) translateY(0);
    }

    .welcome-popup-header {
      margin-bottom: var(--space-6);
    }

    .welcome-popup-title {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: var(--space-3);
      line-height: var(--leading-tight);
    }

    body.dark .welcome-popup-title {
      color: var(--gray-100);
    }

    .welcome-popup-subtitle {
      font-size: var(--font-size-lg);
      color: var(--gray-600);
      line-height: var(--leading-relaxed);
    }

    body.dark .welcome-popup-subtitle {
      color: var(--gray-400);
    }

    .welcome-popup-content {
      margin-bottom: var(--space-8);
    }

    .welcome-popup-features {
      display: grid;
      gap: var(--space-4);
      margin-bottom: var(--space-6);
      text-align: left;
    }

    .welcome-feature {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
    }

    .welcome-feature-icon {
      width: 24px;
      height: 24px;
      background: var(--accent-primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-sm);
      flex-shrink: 0;
      margin-top: 2px;
    }

    .welcome-feature-text {
      flex: 1;
    }

    .welcome-feature-title {
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: var(--space-1);
    }

    body.dark .welcome-feature-title {
      color: var(--gray-100);
    }

    .welcome-feature-description {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      line-height: var(--leading-relaxed);
    }

    body.dark .welcome-feature-description {
      color: var(--gray-400);
    }

    .welcome-popup-actions {
      display: flex;
      gap: var(--space-3);
      justify-content: center;
    }

    .welcome-popup-button {
      padding: var(--space-3) var(--space-6);
      border-radius: var(--radius-lg);
      font-weight: 600;
      font-size: var(--font-size-base);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .welcome-popup-button.primary {
      background: var(--accent-primary);
      color: white;
    }

    .welcome-popup-button.primary:hover {
      background: var(--accent-primary-hover);
      transform: translateY(-1px);
    }

    .welcome-popup-button.secondary {
      background: var(--gray-100);
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
    }

    body.dark .welcome-popup-button.secondary {
      background: var(--dark-surface);
      color: var(--gray-300);
      border-color: var(--dark-surface-hover);
    }

    .welcome-popup-button.secondary:hover {
      background: var(--gray-200);
      transform: translateY(-1px);
    }

    body.dark .welcome-popup-button.secondary:hover {
      background: var(--dark-surface-hover);
    }

    @media (max-width: 768px) {
      .welcome-popup {
        padding: var(--space-6);
        margin: var(--space-4);
      }

      .welcome-popup-title {
        font-size: var(--font-size-2xl);
      }

      .welcome-popup-actions {
        flex-direction: column;
      }

      .welcome-popup-button {
        width: 100%;
        justify-content: center;
      }
    }

    /* Tutorial Styles */
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: var(--z-welcome);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-normal);
    }

    .tutorial-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .tutorial-highlight {
      position: absolute;
      border: 3px solid var(--accent-primary);
      border-radius: var(--radius-lg);
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.8);
      pointer-events: none;
      z-index: calc(var(--z-welcome) + 1);
      transition: all var(--transition-normal);
    }

    .tutorial-tooltip {
      position: absolute;
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      max-width: 350px;
      box-shadow: var(--shadow-xl);
      z-index: calc(var(--z-welcome) + 2);
      transform: scale(0.9);
      opacity: 0;
      transition: all var(--transition-normal);
    }

    body.dark .tutorial-tooltip {
      background: var(--dark-bg-secondary);
      border: 1px solid var(--dark-surface);
    }

    .tutorial-tooltip.show {
      transform: scale(1);
      opacity: 1;
    }

    .tutorial-tooltip-header {
      margin-bottom: var(--space-4);
    }

    .tutorial-tooltip-title {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: var(--space-2);
    }

    body.dark .tutorial-tooltip-title {
      color: var(--gray-100);
    }

    .tutorial-tooltip-description {
      color: var(--gray-600);
      line-height: var(--leading-relaxed);
    }

    body.dark .tutorial-tooltip-description {
      color: var(--gray-400);
    }

    .tutorial-tooltip-actions {
      display: flex;
      gap: var(--space-3);
      justify-content: flex-end;
      margin-top: var(--space-6);
    }

    .tutorial-button {
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-lg);
      font-weight: 500;
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .tutorial-button.primary {
      background: var(--accent-primary);
      color: white;
    }

    .tutorial-button.primary:hover {
      background: var(--accent-primary-hover);
    }

    .tutorial-button.secondary {
      background: var(--gray-100);
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
    }

    body.dark .tutorial-button.secondary {
      background: var(--dark-surface);
      color: var(--gray-300);
      border-color: var(--dark-surface-hover);
    }

    .tutorial-button.secondary:hover {
      background: var(--gray-200);
    }

    body.dark .tutorial-button.secondary:hover {
      background: var(--dark-surface-hover);
    }

    .tutorial-progress {
      position: fixed;
      top: var(--space-6);
      right: var(--space-6);
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--space-3) var(--space-4);
      box-shadow: var(--shadow-lg);
      z-index: calc(var(--z-welcome) + 3);
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--gray-700);
    }

    body.dark .tutorial-progress {
      background: var(--dark-bg-secondary);
      color: var(--gray-300);
      border: 1px soli
      }
      </style>
</head>
<body>
  <!-- Mobile App Download Banner -->
  <div class="mobile-app-banner" id="mobileAppBanner">
    <div class="banner-content">
      <i class="fas fa-mobile-alt"></i>
      <span class="banner-text">Better experience on our mobile app!</span>
    </div>
    <a href="#" class="download-app-btn" id="downloadAppBtn">
      <i class="fas fa-download"></i>
      Download
    </a>
    <button class="banner-close" onclick="closeMobileBanner()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Welcome Popup -->
  <div class="welcome-popup-overlay" id="welcomePopup">
    <div class="welcome-popup">
      <img src="https://i.ibb.co/wNMJSyn6/1000038672.png" alt="Welcome to PRO" style="width: 100%; height: auto; border-radius: var(--radius-lg);">
      <div class="welcome-popup-actions" style="margin-top: var(--space-4);">
        <button class="welcome-popup-button secondary" onclick="closeWelcomePopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Tutorial Overlay -->
  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-highlight" id="tutorialHighlight"></div>
    <div class="tutorial-tooltip" id="tutorialTooltip">
      <div class="tutorial-tooltip-header">
        <div class="tutorial-tooltip-title" id="tutorialTitle"></div>
        <div class="tutorial-tooltip-description" id="tutorialDescription"></div>
      </div>
      <div class="tutorial-tooltip-actions">
        <button class="tutorial-button secondary" onclick="skipTutorial()">
          <i class="fas fa-times"></i>
          Skip
        </button>
        <button class="tutorial-button primary" onclick="nextTutorialStep()">
          <span id="tutorialButtonText">Next</span>
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
    <div class="tutorial-progress" id="tutorialProgress">
      Step <span id="tutorialCurrentStep">1</span> of <span id="tutorialTotalSteps">4</span>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
    <a href="https://vo-ai.netlify.app" target="_blank" class="header-title"><img src="https://image2url.com/images/1758474233044-915e0111-d05a-44c0-a174-4ddf31d3476e.png" alt="VOAI Logo" style="height: 40px;"></a>     <!-- Conversation Name Display -->
      <div class="conversation-name" id="conversationName"></div>
    </div>
    
 
<button id="vopro-glass" onclick="window.location.href='/pricing.html'" style="
  padding: 8px 26px;
  border: none;
  border-radius: 14px;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(14px) saturate(180%);
  color: #ffffff;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  transition: 0.35s ease;
  border: 1px solid rgba(255,255,255,0.2);
  position: relative;
  overflow: hidden;
">
  Try VOPro 
  <span class="liq-glow" style="
    position:absolute; top:-80%; left:-80%;
    width:250%; height:250%;
    background: radial-gradient(circle at center, rgba(255,255,255,0.45), transparent 60%);
    opacity:0; transition:0.45s; pointer-events:none;
  "></span>
</button>

<button onclick="location.href='login'"
style="
padding:10px 20px;
border-radius:10px;
border:none;
background:rgba(255,255,255,0.1);
backdrop-filter:blur(12px);
color:#fff;
cursor:pointer;
">
Create Account / Login
</button>

<script>
fetch('/api/me')
  .then(r => r.json())
  .then(u => {
    if (!u.email) return; // not logged in
    document.getElementById("accountBtn").textContent = "Welcome, " + u.firstName;
  });
</script>



</button>


  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button class="sidebar-toggle-desktop" onclick="toggleSidebarCollapse()" aria-label="Collapse sidebar">
        <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 24 24"><path fill="currentColor" d="M5 5h8v14H5zm14 14h-4V5h4zM4 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm7 9L7 8.5v7z"/></svg>
      </button>
      <h2 class="sidebar-title">
        <i class="fas fa-cog"></i>
        Settings
      </h2>
      <div class="sidebar-actions">
        <button class="sidebar-button" onclick="resetConversation()" title="Start new chat">
          <i class="fas fa-plus"></i>
          New
        </button>
        <button class="sidebar-button secondary" onclick="toggleTheme()" title="Toggle theme" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>

    <!-- Collapsed Sidebar Icons -->
    <div class="sidebar-icons">
      <button class="sidebar-icon" onclick="resetConversation()" title="New Chat">
        <i class="fas fa-plus"></i>
      </button>
      <button class="sidebar-icon" onclick="toggleTheme()" title="Toggle Theme">
        <i class="fas fa-moon" id="collapsedThemeIcon"></i>
      </button>
      <button class="sidebar-icon" onclick="showMemorySection()" title="Memory">
       <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M13 4H6a1 1 0 0 0-1 1v10.337A3.5 3.5 0 0 1 6.5 15H19v-5h2v11a1 1 0 0 1-1 1H6.5A3.5 3.5 0 0 1 3 18.5V5a3 3 0 0 1 3-3h7zM6.5 17a1.5 1.5 0 0 0 0 3H19v-3zM18.53.33a.507.507 0 0 1 .94 0l.254.61a4.37 4.37 0 0 0 2.25 2.327l.718.32a.53.53 0 0 1 0 .962l-.76.338a4.36 4.36 0 0 0-2.218 2.25l-.247.566a.506.506 0 0 1-.934 0l-.246-.565a4.36 4.36 0 0 0-2.22-2.251l-.76-.338a.53.53 0 0 1 0-.963l.718-.32A4.37 4.37 0 0 0 18.276.942z"/></svg>
      </button>
      <button class="sidebar-icon" onclick="showHistorySection()" title="History">
        <i class="fas fa-history"></i>
      </button>
    </div>
    
    <div class="sidebar-content">
      <div class="memory-section">
        <h3 class="section-title">
      <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M13 4H6a1 1 0 0 0-1 1v10.337A3.5 3.5 0 0 1 6.5 15H19v-5h2v11a1 1 0 0 1-1 1H6.5A3.5 3.5 0 0 1 3 18.5V5a3 3 0 0 1 3-3h7zM6.5 17a1.5 1.5 0 0 0 0 3H19v-3zM18.53.33a.507.507 0 0 1 .94 0l.254.61a4.37 4.37 0 0 0 2.25 2.327l.718.32a.53.53 0 0 1 0 .962l-.76.338a4.36 4.36 0 0 0-2.218 2.25l-.247.566a.506.506 0 0 1-.934 0l-.246-.565a4.36 4.36 0 0 0-2.22-2.251l-.76-.338a.53.53 0 0 1 0-.963l.718-.32A4.37 4.37 0 0 0 18.276.942z"/></svg>
          Personalization
        </h3>
          <textarea 
          class="memory-textarea" 
          id="memoryInput" 
          placeholder="Add context about yourself that the AI should remember..."
          rows="4"
        ></textarea>
        <div class="memory-actions">
          <button class="sidebar-button" onclick="saveMemory()">
            <i class="fas fa-save"></i>
            Save
          </button>
          <button class="sidebar-button secondary" onclick="clearMemory()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3Zm1 2H6v12h12V8Zm-4.586 6l1.768 1.768l-1.414 1.414L12 15.414l-1.768 1.768l-1.414-1.414L10.586 14l-1.768-1.768l1.414-1.414L12 12.586l1.768-1.768l1.414 1.414L13.414 14ZM9 4v2h6V4H9Z"/></svg>
            Clear
          </button>
        </div>
      </div>
      
      <div class="history-section">
        <h3 class="section-title">
          <i class="fas fa-history"></i>
          Chat History
        </h3>
        <div class="history-list" id="historyList">
          <div class="empty-state">
            <p>No saved chats yet</p>
          </div>
        </div>
      </div>
    </div>
  </aside>

<main class="main-content">
  <div class="chat-container" id="chatContainer">
    <div class="chat-messages" id="chatMessages">
      <div class="empty-state" id="emptyState">
        <div class="empty-state-icon"></div>
        <h1 class="empty-state-title" id="title"></h1>
        <p class="empty-state-subtitle">
          Help us improve VO 
          <a href="https://vo-ai.netlify.app/feedback" class="link">feedback</a>
        </p>

<style>
.link {
  color: currentColor;
  text-decoration: none;
}
.link:hover {
  color: burlywood;
}
.link:visited {
  color: currentColor;
}
</style>
          <button class="start-button" onclick="startChat()">
            <i class="fas fa-play"></i>
            Start Conversation
          </button>
          
          <!-- Conversation Starters -->
          <div class="conversation-starters" id="conversationStarters">
            <h3>Try asking about:</h3>
            <div class="starter-grid">
              <div class="starter-item" onclick="sendMessage('Help me write a professional email')">
                <h4><i class="fas fa-envelope"></i> Email Writing</h4>
                <p>Get help crafting professional emails for any situation</p>
              </div>
              <div class="starter-item" onclick="sendMessage('Explain quantum computing in simple terms')">
                <h4><i class="fas fa-atom"></i> Complex Topics</h4>
                <p>Break down complex subjects into easy-to-understand explanations</p>
              </div>
              <div class="starter-item" onclick="sendMessage('Help me plan a productive day')">
                <h4><i class="fas fa-calendar-check"></i> Planning & Organization</h4>
                <p>Create schedules, to-do lists, and productivity strategies</p>
              </div>
              <div class="starter-item" onclick="sendMessage('Write a Python function to sort a list')">
                <h4><i class="fas fa-code"></i> Programming Help</h4>
                <p>Get coding assistance, debugging help, and best practices</p>
              </div>
              <div class="starter-item" onclick="sendMessage('Suggest a healthy meal plan for this week')">
                <h4><i class="fas fa-utensils"></i> Health & Wellness</h4>
                <p>Get advice on nutrition, fitness, and healthy lifestyle choices</p>
              </div>
              <div class="starter-item" onclick="sendMessage('Help me brainstorm creative ideas for my project')">
                <h4><i class="fas fa-lightbulb"></i> Creative Brainstorming</h4>
                <p>Generate innovative ideas and creative solutions</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Input Area -->
  <div class="input-area">
    <div class="input-container">
      <div class="input-wrapper">
        <div class="input-actions">
          <button class="input-action" onclick="toggleFileMenu()" title="Attach file" aria-label="Attach file">
            <i class="fas fa-paperclip"></i>
          </button>
          <div class="file-menu" id="fileMenu">
            <button class="file-menu-item" onclick="document.getElementById('fileInput').click()">
              <i class="fas fa-file"></i>
              <span>Upload Document</span>
            </button>
            <button class="file-menu-item" onclick="document.getElementById('imageInput').click()">
              <i class="fas fa-image"></i>
              <span>Upload Image</span>
            </button>
            <button class="file-menu-item" onclick="document.getElementById('videoInput').DONTclick()">
              <i class="fas fa-video"></i>
              <span>(coming soon)</span>
            </button>
            <button class="file-menu-item" onclick="document.getElementById('archiveInput').click()">
              <i class="fas fa-file-archive"></i>
              <span>Upload Archive</span>
            </button>
            <button class="file-menu-item" onclick="activateImageSearch()">
              <i class="fas fa-search"></i>
              <span>Search Images</span>
            </button>
          </div>
        </div>
        
        <textarea 
          class="message-input" 
          id="messageInput" 
          placeholder="ask anything..."
          rows="1"
          onkeydown="handleKeyDown(event)"
          oninput="autoResize(this)"
        ></textarea>
        
        <button class="send-button" onclick="handleSend()" title="Send message" aria-label="Send message">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      <!-- Powered by Vendo text -->
      <div class="powered-by">
        Powered by <a href="#" target="_blank">Vendo</a>
      </div>
    </div>
  </div>

  <!-- Right-side Code View Panel -->
  <div class="code-view-panel" id="codeViewPanel">
    <div class="code-view-header">
      <h3 id="codeViewTitle">Code View</h3>
      <button class="code-view-close" onclick="closeCodeView()" title="Close code view">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="code-view-actions">
      <button class="code-view-action" onclick="copyCodeFromView()" title="Copy code">
        <i class="fas fa-copy"></i>
        Copy Code
      </button>
      <button class="code-view-action" onclick="runCodeFromView()" title="Run code">
        <i class="fas fa-play"></i>
        Run Code
      </button>
      <button class="code-view-action" onclick="downloadCodeFromView()" title="Download code">
        <i class="fas fa-download"></i>
        Download
      </button>
    </div>
    <div class="code-view-content">
      <pre><code id="codeViewCode"></code></pre>
    </div>
    <div class="code-view-output" id="codeViewOutput" style="display: none;">
      <h4>Output:</h4>
      <pre id="codeViewOutputContent"></pre>
    </div>
  </div>

  <!-- Hidden File Inputs -->
  <input type="file" id="fileInput" class="file-input" accept=".txt,.js,.html,.css,.json,.pdf,.doc,.docx,.xlsx,.xls,.csv,.xml,.md,.rtf,.odt" onchange="handleFileUpload(event)" />
  <input type="file" id="imageInput" class="file-input" accept="image/*" onchange="handleImageUpload(event)" />
  <input type="file" id="videoInput" class="file-input" accept="video/*" onchange="handleVideoUpload(event)" />
  <input type="file" id="archiveInput" class="file-input" accept=".zip,.rar,.7z,.tar,.gz" onchange="handleArchiveUpload(event)" />

  <script>
  
  const CURRENT_PLAN = "free";


  // Constants and Configuration
    const PEXELS_API_KEY = 'K5dzLAy2IIVWjIu1IGQftPVQsA888jorGEfoSFev1vZFJR94gTzXIvbw';
    
    // DOM Elements
    const sidebar = document.getElementById('sidebar');
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const fileInput = document.getElementById('fileInput');
    const imageInput = document.getElementById('imageInput');
    const videoInput = document.getElementById('videoInput');
    const archiveInput = document.getElementById('archiveInput');
    const memoryInput = document.getElementById('memoryInput');
    const historyList = document.getElementById('historyList');
    const emptyState = document.getElementById('emptyState');
    const fileMenu = document.getElementById('fileMenu');
    const themeToggle = document.getElementById('themeToggle');
    const conversationStarters = document.getElementById('conversationStarters');
    const mobileAppBanner = document.getElementById('mobileAppBanner');
    const downloadAppBtn = document.getElementById('downloadAppBtn');
    const conversationName = document.getElementById('conversationName');
    
    // Application State
    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
    let currentRequest = null;
    let isImageSearchMode = false;
    let currentChatId = null;
    let touchStartX = 0;
    let touchEndX = 0;
    const SWIPE_THRESHOLD = 50;
    let responseStartTime = 0;

    let currentModel = {
      name: 'lixern',
      apiKey: '',
      modelId: 'openai/gpt-oss-20b',
      endpoint: '/api/groq'
    };

    const btnGlass = document.getElementById("vopro-glass");
const glow = btnGlass.querySelector(".liq-glow");

btnGlass.onmousemove = (e)=>{
  const rect = btnGlass.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  glow.style.left = `${x - glow.offsetWidth/2}px`;
  glow.style.top = `${y - glow.offsetHeight/2}px`;
  glow.style.opacity = "0.55";
};

btnGlass.onmouseleave = ()=>{
  glow.style.opacity = "0";
};


    // Enhanced File Type Detection
    const fileTypeMap = {
      // Documents
      'pdf': { icon: 'fas fa-file-pdf', color: '#d32f2f', type: 'document' },
      'doc': { icon: 'fas fa-file-word', color: '#1976d2', type: 'document' },
      'docx': { icon: 'fas fa-file-word', color: '#1976d2', type: 'document' },
      'odt': { icon: 'fas fa-file-alt', color: '#388e3c', type: 'document' },
      'rtf': { icon: 'fas fa-file-alt', color: '#795548', type: 'document' },
      'txt': { icon: 'fas fa-file-alt', color: '#616161', type: 'text' },
      'md': { icon: 'fas fa-file-alt', color: '#424242', type: 'text' },
      
      // Spreadsheets
      'xlsx': { icon: 'fas fa-file-excel', color: '#388e3c', type: 'spreadsheet' },
      'xls': { icon: 'fas fa-file-excel', color: '#388e3c', type: 'spreadsheet' },
      'csv': { icon: 'fas fa-file-csv', color: '#ff9800', type: 'spreadsheet' },
      
      // Code files
      'js': { icon: 'fas fa-file-code', color: '#f57c00', type: 'code' },
      'html': { icon: 'fas fa-file-code', color: '#e65100', type: 'code' },
      'css': { icon: 'fas fa-file-code', color: '#1976d2', type: 'code' },
      'json': { icon: 'fas fa-file-code', color: '#388e3c', type: 'code' },
      'xml': { icon: 'fas fa-file-code', color: '#ff5722', type: 'code' },
      'py': { icon: 'fas fa-file-code', color: '#3776ab', type: 'code' },
      'java': { icon: 'fas fa-file-code', color: '#ed8b00', type: 'code' },
      'cpp': { icon: 'fas fa-file-code', color: '#00599c', type: 'code' },
      'c': { icon: 'fas fa-file-code', color: '#a8b9cc', type: 'code' },
      
      // Images
      'jpg': { icon: 'fas fa-file-image', color: '#4caf50', type: 'image' },
      'jpeg': { icon: 'fas fa-file-image', color: '#4caf50', type: 'image' },
      'png': { icon: 'fas fa-file-image', color: '#2196f3', type: 'image' },
      'gif': { icon: 'fas fa-file-image', color: '#ff9800', type: 'image' },
      'bmp': { icon: 'fas fa-file-image', color: '#9c27b0', type: 'image' },
      'svg': { icon: 'fas fa-file-image', color: '#ff5722', type: 'image' },
      'webp': { icon: 'fas fa-file-image', color: '#607d8b', type: 'image' },
      
      // Videos
      'mp4': { icon: 'fas fa-file-video', color: '#f44336', type: 'video' },
      'avi': { icon: 'fas fa-file-video', color: '#e91e63', type: 'video' },
      'mov': { icon: 'fas fa-file-video', color: '#9c27b0', type: 'video' },
      'wmv': { icon: 'fas fa-file-video', color: '#673ab7', type: 'video' },
      'flv': { icon: 'fas fa-file-video', color: '#3f51b5', type: 'video' },
      'webm': { icon: 'fas fa-file-video', color: '#2196f3', type: 'video' },
      
      // Archives
      'zip': { icon: 'fas fa-file-archive', color: '#795548', type: 'archive' },
      'rar': { icon: 'fas fa-file-archive', color: '#8bc34a', type: 'archive' },
      '7z': { icon: 'fas fa-file-archive', color: '#cddc39', type: 'archive' },
      'tar': { icon: 'fas fa-file-archive', color: '#ff9800', type: 'archive' },
      'gz': { icon: 'fas fa-file-archive', color: '#ff5722', type: 'archive' },
      
      // Default
      'default': { icon: 'fas fa-file', color: '#757575', type: 'unknown' }
    };

    // Device Detection
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
             (window.innerWidth <= 768 && 'ontouchstart' in window);
    }

    function isTabletDevice() {
      return /iPad|Android/i.test(navigator.userAgent) && window.innerWidth >= 768 && window.innerWidth <= 1024;
    }

    // Initialize Application
    window.addEventListener('DOMContentLoaded', () => {
      initializeApp();
    });

    function initializeApp() {
      loadTheme();
      loadMemory();
      loadChatHistory();
      loadSidebarState();
      detectDeviceAndShowBanner();
      
      if (chatHistory.length > 0) {
        loadCurrentChat();
      }

      // Event Listeners
      setupEventListeners();
    }

    function detectDeviceAndShowBanner() {
      if (isMobileDevice() && !localStorage.getItem('mobileAppBannerDismissed')) {
        mobileAppBanner.classList.add('show');
        document.body.classList.add('mobile-banner-shown');
        
        // Set up APK download
        downloadAppBtn.href = './VOAI-App.apk';
        downloadAppBtn.download = 'VOAI-App.apk';
      }
    }

    function closeMobileBanner() {
      mobileAppBanner.classList.remove('show');
      document.body.classList.remove('mobile-banner-shown');
      localStorage.setItem('mobileAppBannerDismissed', 'true');
    }

    function setupEventListeners() {
      // Touch events for mobile
      document.addEventListener('touchstart', handleTouchStart, { passive: true });
      document.addEventListener('touchmove', handleTouchMove, { passive: false });
      document.addEventListener('touchend', handleTouchEnd, { passive: true });

      // Click outside to close dropdowns
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.input-actions')) {
          fileMenu.classList.remove('show');
        }
      });

      // Auto-resize textarea
      messageInput.addEventListener('input', () => autoResize(messageInput));

      // Prevent zoom on double tap for iOS
      let lastTouchEnd = 0;
      document.addEventListener('touchend', (event) => {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
    }

    // Sidebar State Management
    function loadSidebarState() {
      const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
      if (isCollapsed && window.innerWidth > 768) {
        sidebar.classList.add('collapsed');
      }
    }

    function toggleSidebarCollapse() {
      sidebar.classList.toggle('collapsed');
      localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    }

    // Theme Management
    function loadTheme() {
      const isDark = localStorage.getItem('darkTheme') === 'true';
      if (isDark) {
        document.body.classList.add('dark');
      }
      updateThemeIcon();
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('darkTheme', isDark);
      updateThemeIcon();
    }

    function updateThemeIcon() {
      const isDark = document.body.classList.contains('dark');
      const icon = themeToggle.querySelector('i');
      const collapsedIcon = document.getElementById('collapsedThemeIcon');
      const iconClass = isDark ? 'fas fa-sun' : 'fas fa-moon';
      icon.className = iconClass;
      if (collapsedIcon) {
        collapsedIcon.className = iconClass;
      }
    }

    // Memory Management
    function loadMemory() {
      const savedMemory = localStorage.getItem('botMemory');
      if (savedMemory) {
        memoryInput.value = savedMemory;
      }
    }

    function saveMemory() {
      const memoryText = memoryInput.value.trim();
      localStorage.setItem('botMemory', memoryText);
      
      // Update memory in current chat if exists
      if (currentChatId !== null) {
        const savedChats = JSON.parse(localStorage.getItem('savedChats')) || [];
        if (savedChats[currentChatId]) {
          savedChats[currentChatId].memory = memoryText;
          localStorage.setItem('savedChats', JSON.stringify(savedChats));
        }
      }
      
      // Add memory to chat context if not already present
      if (memoryText) {
        const memoryMessage = `[System Memory Note]: ${memoryText}`;
        if (!chatHistory.some(msg => msg.content.includes('[System Memory Note]'))) {
          chatHistory.push({ role: 'system', content: memoryMessage });
          localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }
      }
      
      // Show confirmation
      showSaveConfirmation();
    }

    function clearMemory() {
      if (confirm('Are you sure you want to clear your memory?')) {
        memoryInput.value = '';
        localStorage.removeItem('botMemory');
        
        // Remove memory from current chat if exists
        if (currentChatId !== null) {
          const savedChats = JSON.parse(localStorage.getItem('savedChats')) || [];
          if (savedChats[currentChatId]) {
            savedChats[currentChatId].memory = '';
            localStorage.setItem('savedChats', JSON.stringify(savedChats));
          }
        }
        
        // Remove memory message from chat history
        chatHistory = chatHistory.filter(msg => !msg.content.includes('[System Memory Note]'));
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
      }
    }

    function showSaveConfirmation() {
      const saveBtn = document.querySelector('.memory-actions .sidebar-button');
      const originalHTML = saveBtn.innerHTML;
      saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
      saveBtn.style.background = 'var(--accent-success)';
      
      setTimeout(() => {
        saveBtn.innerHTML = originalHTML;
        saveBtn.style.background = '';
      }, 2000);
    }

    // Chat History Management
    function loadChatHistory() {
      const savedChats = JSON.parse(localStorage.getItem('savedChats')) || [];
      
      if (savedChats.length === 0) {
        historyList.innerHTML = '<div class="empty-state"><p>No saved chats yet</p></div>';
        return;
      }

      historyList.innerHTML = savedChats.map((chat, index) => `
        <div class="history-item ${currentChatId === index ? 'active' : ''}" onclick="loadSavedChat(${index})">
          <span class="history-text">${chat.name}</span>
          <button class="history-delete" onclick="deleteChatHistory(event, ${index})" title="Delete chat">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3Zm1 2H6v12h12V8Zm-4.586 6l1.768 1.768l-1.414 1.414L12 15.414l-1.768 1.768l-1.414-1.414L10.586 14l-1.768-1.768l1.414-1.414L12 12.586l1.768-1.768l1.414 1.414L13.414 14ZM9 4v2h6V4H9Z"/></svg>
          </button>
        </div>
      `).join('');
    }

    function loadCurrentChat() {
      hideEmptyState();
      chatHistory.forEach(msg => {
        if (msg.role === 'user') {
          addUserMessage(msg.content);
        } else if (msg.role === 'assistant') {
          addBotMessage(msg.content);
        }
      });
      
      // Update conversation name
      updateConversationName();
    }

    function saveCurrentChat() {
      if (chatHistory.length === 0) return;
      
      const savedChats = JSON.parse(localStorage.getItem('savedChats')) || [];
      const chatName = chatHistory[0].content.substring(0, 30) + (chatHistory[0].content.length > 30 ? '...' : '');
      
      // Update existing chat or add new one
      if (currentChatId !== null && savedChats[currentChatId]) {
        savedChats[currentChatId] = {
          name: chatName,
          history: [...chatHistory],
          memory: memoryInput.value
        };
      } else {
        currentChatId = savedChats.length;
        savedChats.push({
          name: chatName,
          history: [...chatHistory],
          memory: memoryInput.value
        });
      }
      
      localStorage.setItem('savedChats', JSON.stringify(savedChats));
      loadChatHistory();
      
      // Update conversation name
      updateConversationName();
    }

    function loadSavedChat(index) {
      const savedChats = JSON.parse(localStorage.getItem('savedChats')) || [];
      if (index >= savedChats.length) return;
      
      const chat = savedChats[index];
      currentChatId = index;
      
      // Clear current chat
      chatMessages.innerHTML = '';
      chatHistory = [...chat.history];
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
      
      // Load memory
      memoryInput.value = chat.memory || '';
      localStorage.setItem('botMemory', chat.memory || '');
      
      // Load messages
      hideEmptyState();
      chatHistory.forEach(msg => {
        if (msg.role === 'user') {
          addUserMessage(msg.content);
        } else if (msg.role === 'assistant') {
          addBotMessage(msg.content);
        }
      });
      
      // Close sidebar on mobile
      if (window.innerWidth <= 768) {
        sidebar.classList.remove('show');
      }
      
      loadChatHistory(); // Refresh to show active state
      
      // Update conversation name
      updateConversationName();
    }

    function deleteChatHistory(event, index) {
      event.stopPropagation();
      
      if (!confirm('Are you sure you want to delete this chat?')) return;
      
      const savedChats = JSON.parse(localStorage.getItem('savedChats')) || [];
      savedChats.splice(index, 1);
      localStorage.setItem('savedChats', JSON.stringify(savedChats));
      
      if (currentChatId === index) {
        currentChatId = null;
        resetConversation();
      } else if (currentChatId > index) {
        currentChatId--;
      }
      
      loadChatHistory();
    }

    // Update Conversation Name
    function updateConversationName() {
      if (chatHistory.length > 0 && chatHistory[0].role === 'user') {
        const firstMessage = chatHistory[0].content;
        const displayName = firstMessage.length > 30 ? firstMessage.substring(0, 30) + '...' : firstMessage;
        conversationName.textContent = displayName;
      } else {
        conversationName.textContent = '';
      }
    }

    // Model Management
    function switchModel(name, apiKey, modelId) {
      // Update active state for model buttons
      document.querySelectorAll('.model-button').forEach(btn => {
        btn.classList.toggle('active', btn.querySelector('span').textContent === name);
      });
      
      currentModel = { name, apiKey, modelId };
    }

    // Sidebar Management
    function toggleSidebar() {
      sidebar.classList.toggle('show');
    }

    // Touch Events for Mobile
    function handleTouchStart(event) {
      touchStartX = event.changedTouches[0].screenX;
    }

    function handleTouchMove(event) {
      if (sidebar.classList.contains('show')) {
        event.preventDefault();
      }
    }

    function handleTouchEnd(event) {
      touchEndX = event.changedTouches[0].screenX;
      handleSwipe();
    }

    function handleSwipe() {
      const difference = touchStartX - touchEndX;
      
      // Swipe left to right (open sidebar)
      if (difference < -SWIPE_THRESHOLD && !sidebar.classList.contains('show')) {
        toggleSidebar();
      }
      // Swipe right to left (close sidebar)
      else if (difference > SWIPE_THRESHOLD && sidebar.classList.contains('show')) {
        toggleSidebar();
      }
    }

    // Chat Management
    function startChat() {
      sendMessage("Hello!");
    }

    function resetConversation() {
      // Auto-save current chat before resetting
      if (chatHistory.length > 0) {
        saveCurrentChat();
      }
      
      chatMessages.innerHTML = '';
      chatHistory = [];
      currentChatId = null;
      localStorage.removeItem('chatHistory');
      messageInput.value = '';
      exitImageSearchMode();
      showEmptyState();
      
      // Clear conversation name
      conversationName.textContent = '';
    }

    function showEmptyState() {
      if (!document.getElementById('emptyState')) {
        const emptyStateHTML = `
          <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">
            </div>
            <h2 class="empty-state-title">VOAI Assistant</h2>
            <p class="empty-state-subtitle">Start a conversation to get professional assistance</p>
            <button class="start-button" onclick="startChat()">
              <i class="fas fa-play"></i>
              Start Conversation
            </button>
            
            <!-- Conversation Starters -->
            <div class="conversation-starters" id="conversationStarters">
              <h3>Try asking about:</h3>
              <div class="starter-grid">
                <div class="starter-item" onclick="sendMessage('Help me write a professional email')">
                  <h4><i class="fas fa-envelope"></i> Email Writing</h4>
                  <p>Get help crafting professional emails for any situation</p>
                </div>
                <div class="starter-item" onclick="sendMessage('Explain quantum computing in simple terms')">
                  <h4><i class="fas fa-atom"></i> Complex Topics</h4>
                  <p>Break down complex subjects into easy-to-understand explanations</p>
                </div>
                <div class="starter-item" onclick="sendMessage('Help me plan a productive day')">
                  <h4><i class="fas fa-calendar-check"></i> Planning & Organization</h4>
                  <p>Create schedules, to-do lists, and productivity strategies</p>
                </div>
                <div class="starter-item" onclick="sendMessage('Write a Python function to sort a list')">
                  <h4><i class="fas fa-code"></i> Programming Help</h4>
                  <p>Get coding assistance, debugging help, and best practices</p>
                </div>
                <div class="starter-item" onclick="sendMessage('Suggest a healthy meal plan for this week')">
                  <h4><i class="fas fa-utensils"></i> Health & Wellness</h4>
                  <p>Get advice on nutrition, fitness, and healthy lifestyle choices</p>
                </div>
                <div class="starter-item" onclick="sendMessage('Help me brainstorm creative ideas for my project')">
                  <h4><i class="fas fa-lightbulb"></i> Creative Brainstorming</h4>
                  <p>Generate innovative ideas and creative solutions</p>
                </div>
              </div>
            </div>
          </div>
        `;
        chatMessages.innerHTML = emptyStateHTML;
      }
    }

    function hideEmptyState() {
      const emptyState = document.getElementById('emptyState');
      if (emptyState) {
        emptyState.remove();
      }
    }

    // Enhanced File Management
    function toggleFileMenu() {
      fileMenu.classList.toggle('show');
    }

    function getFileExtension(filename) {
      return filename.split('.').pop().toLowerCase();
    }

    function getFileTypeInfo(filename) {
      const extension = getFileExtension(filename);
      return fileTypeMap[extension] || fileTypeMap['default'];
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Enhanced File Upload Handlers
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const fileTypeInfo = getFileTypeInfo(file.name);
      showFilePreview(file, fileTypeInfo);
      
      // Process file based on type
      processFile(file, fileTypeInfo);
      
      fileInput.value = '';
      fileMenu.classList.remove('show');
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const fileTypeInfo = getFileTypeInfo(file.name);
      showImagePreview(file, fileTypeInfo);
      
      imageInput.value = '';
      fileMenu.classList.remove('show');
    }

    function handleVideoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const fileTypeInfo = getFileTypeInfo(file.name);
      showVideoPreview(file, fileTypeInfo);
      
      videoInput.value = '';
      fileMenu.classList.remove('show');
    }

    function handleArchiveUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const fileTypeInfo = getFileTypeInfo(file.name);
      showArchivePreview(file, fileTypeInfo);
      
      archiveInput.value = '';
      fileMenu.classList.remove('show');
    }

    function showFilePreview(file, fileTypeInfo) {
      const previewHTML = `
        <div class="file-preview">
          <div class="file-preview-header">
            <div class="file-info">
              <div class="file-icon" style="background-color: ${fileTypeInfo.color}">
                <i class="${fileTypeInfo.icon}"></i>
              </div>
              <div class="file-details">
                <h4>${file.name}</h4>
                <p>${formatFileSize(file.size)}  ${fileTypeInfo.type}</p>
              </div>
            </div>
            <div class="file-actions">
              <button class="file-action" onclick="downloadFile('${file.name}', '${file.type}')" title="Download file">
                <i class="fas fa-download"></i>
                Download
              </button>
            </div>
          </div>
        </div>
      `;
      
      addUserMessage(` Uploaded file: ${file.name}`);
      chatMessages.insertAdjacentHTML('beforeend', previewHTML);
      scrollToBottom();
    }

    function showImagePreview(file, fileTypeInfo) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const previewHTML = `
          <div class="file-preview">
            <div class="file-preview-header">
              <div class="file-info">
                <div class="file-icon" style="background-color: ${fileTypeInfo.color}">
                  <i class="${fileTypeInfo.icon}"></i>
                </div>
                <div class="file-details">
                  <h4>${file.name}</h4>
                  <p>${formatFileSize(file.size)}  Image</p>
                </div>
              </div>
              <div class="file-actions">
                <button class="file-action" onclick="analyzeImage('${e.target.result}', '${file.name}')" title="Analyze image">
                  <i class="fas fa-search"></i>
                  Analyze
                </button>
                <button class="file-action" onclick="extractTextFromImage('${e.target.result}', '${file.name}')" title="Extract text (OCR)">
                  <i class="fas fa-font"></i>
                  OCR
                </button>
              </div>
            </div>
            <img src="${e.target.result}" alt="${file.name}" class="image-preview" onclick="openImageFullscreen('${e.target.result}')">
          </div>
        `;
        
        addUserMessage(` Uploaded image: ${file.name}`);
        chatMessages.insertAdjacentHTML('beforeend', previewHTML);
        scrollToBottom();
        
        // Automatically analyze the image
        setTimeout(() => {
          analyzeImage(e.target.result, file.name);
        }, 500);
      };
      reader.readAsDataURL(file);
    }

    function showVideoPreview(file, fileTypeInfo) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const previewHTML = `
          <div class="file-preview">
            <div class="file-preview-header">
              <div class="file-info">
                <div class="file-icon" style="background-color: ${fileTypeInfo.color}">
                  <i class="${fileTypeInfo.icon}"></i>
                </div>
                <div class="file-details">
                  <h4>${file.name}</h4>
                  <p>${formatFileSize(file.size)}  Video</p>
                </div>
              </div>
              <div class="file-actions">
                <button class="file-action" onclick="extractVideoFrames('${e.target.result}')" title="Extract frames">
                  <i class="fas fa-images"></i>
                  Extract Frames
                </button>
              </div>
            </div>
            <video controls style="max-width: 100%; border-radius: var(--radius-lg);">
              <source src="${e.target.result}" type="${file.type}">
              Your browser does not support the video tag.
            </video>
          </div>
        `;
        
        addUserMessage(` Uploaded video: ${file.name}`);
        chatMessages.insertAdjacentHTML('beforeend', previewHTML);
        scrollToBottom();
      };
      reader.readAsDataURL(file);
    }

    function showArchivePreview(file, fileTypeInfo) {
      const previewHTML = `
        <div class="file-preview">
          <div class="file-preview-header">
            <div class="file-info">
              <div class="file-icon" style="background-color: ${fileTypeInfo.color}">
                <i class="${fileTypeInfo.icon}"></i>
              </div>
              <div class="file-details">
                <h4>${file.name}</h4>
                <p>${formatFileSize(file.size)}  Archive</p>
              </div>
            </div>
            <div class="file-actions">
              <button class="file-action" onclick="listArchiveContents('${file.name}')" title="List contents">
                <i class="fas fa-list"></i>
                List Contents
              </button>
            </div>
          </div>
          <div class="file-content">
            Archive uploaded successfully. Use the "List Contents" button to explore the archive structure.
          </div>
        </div>
      `;
      
      addUserMessage(` Uploaded archive: ${file.name}`);
      chatMessages.insertAdjacentHTML('beforeend', previewHTML);
      scrollToBottom();
    }

    function processFile(file, fileTypeInfo) {
      if (fileTypeInfo.type === 'text' || fileTypeInfo.type === 'code') {
        const reader = new FileReader();
        reader.onload = (e) => {
          const content = e.target.result;
          if (content.trim()) {
            sendMessage(`File content from ${file.name}:\n\n${content.trim()}`);
          }
        };
        reader.readAsText(file);
      } else if (fileTypeInfo.type === 'document') {
        if (file.name.toLowerCase().endsWith('.pdf')) {
          extractTextFromPDF(file);
        } else if (file.name.toLowerCase().endsWith('.docx') || file.name.toLowerCase().endsWith('.doc')) {
          extractTextFromWord(file);
        } else {
          addBotMessage(` Document uploaded: ${file.name}. Advanced document processing is available for PDF and Word files.`);
        }
      } else if (fileTypeInfo.type === 'spreadsheet') {
        extractDataFromSpreadsheet(file);
      }
    }

    async function extractTextFromPDF(file) {
      try {
        addBotMessage(` Processing PDF file: ${file.name}...`);
        
        const arrayBuffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(arrayBuffer);
        
        // Advanced PDF text extraction using PDF.js
        const extractionResult = await extractAdvancedPDFText(uint8Array);
        
        if (extractionResult.text && extractionResult.text.length > 100) {
          // Send the extracted text as a message
          const message = ` **PDF Analysis Complete: ${file.name}**`;
          addBotMessage(message, null, extractionResult.text);
          
          // Add to chat history
          chatHistory.push({
            role: 'user',
            content: `Uploaded ${file.name}`
          });
          chatHistory.push({
            role: 'assistant',
            content: message
          });
          localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        } else {
          addBotMessage(` PDF processed: ${file.name}\n\nThe PDF was processed but may contain primarily images or encrypted content. ${extractionResult.pageCount} pages were analyzed.`);
        }
        } catch (e) {
        console.error('PDF extraction error:', e);
        addBotMessage(` Error processing PDF: ${file.name}. The file may be corrupted or encrypted.`);
      }
    }

    // Advanced PDF text extraction function using PDF.js
    async function extractAdvancedPDFText(uint8Array) {
      try {
        if (typeof pdfjsLib === 'undefined') {
          throw new Error('PDF.js library not loaded');
        }

        // Set PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Load the PDF document
        const pdf = await pdfjsLib.getDocument({ data: uint8Array }).promise;
        
        let fullText = '';
        let structure = {
          pages: [],
          headings: [],
          paragraphs: [],
          tables: []
        };
        
        // Extract metadata
        const metadata = await pdf.getMetadata();
        
        // Process each page
        for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
          const page = await pdf.getPage(pageNum);
          const textContent = await page.getTextContent();
          
          let pageText = '';
          let pageStructure = {
            pageNumber: pageNum,
            textItems: [],
            headings: [],
            paragraphs: []
          };
          
          // Process text items with positioning and formatting
          textContent.items.forEach((item, index) => {
            const text = item.str.trim();
            if (text) {
              // Analyze text properties for structure detection
              const fontSize = item.height || 12;
              const fontName = item.fontName || '';
              const isHeading = fontSize > 14 || fontName.toLowerCase().includes('bold');
              const isBold = fontName.toLowerCase().includes('bold');
              
              // Store text item with metadata
              pageStructure.textItems.push({
                text: text,
                fontSize: fontSize,
                fontName: fontName,
                x: item.transform[4],
                y: item.transform[5],
                isHeading: isHeading,
                isBold: isBold
              });
              
              // Classify content
              if (isHeading && text.length < 100) {
                pageStructure.headings.push(text);
                structure.headings.push({
                  text: text,
                  page: pageNum,
                  level: fontSize > 18 ? 1 : fontSize > 16 ? 2 : 3
                });
                pageText += `\n## ${text}\n`;
              } else {
                pageText += text + ' ';
              }
            }
          });
          
          // Clean up page text and format paragraphs
          pageText = pageText.replace(/\s+/g, ' ').trim();
          
          // Split into paragraphs based on sentence patterns
          const sentences = pageText.split(/(?<=[.!?])\s+/);
          let currentParagraph = '';
          
          sentences.forEach(sentence => {
            if (currentParagraph.length + sentence.length > 200) {
              if (currentParagraph.trim()) {
                pageStructure.paragraphs.push(currentParagraph.trim());
                structure.paragraphs.push({
                  text: currentParagraph.trim(),
                  page: pageNum
                });
              }
              currentParagraph = sentence;
            } else {
              currentParagraph += (currentParagraph ? ' ' : '') + sentence;
            }
          });
          
          // Add final paragraph
          if (currentParagraph.trim()) {
            pageStructure.paragraphs.push(currentParagraph.trim());
            structure.paragraphs.push({
              text: currentParagraph.trim(),
              page: pageNum
            });
          }
          
          structure.pages.push(pageStructure);
          fullText += `\n--- Page ${pageNum} ---\n${pageText}\n`;
        }
        
        // Detect and extract tables (basic implementation)
        structure.tables = detectTablesInText(fullText);
        
        // Format the final text with proper structure
        let formattedText = `# PDF Document Analysis\n\n`;
        
        if (metadata.info?.Title) {
          formattedText += `**Title:** ${metadata.info.Title}\n`;
        }
        if (metadata.info?.Author) {
          formattedText += `**Author:** ${metadata.info.Author}\n`;
        }
        if (metadata.info?.Subject) {
          formattedText += `**Subject:** ${metadata.info.Subject}\n`;
        }
        if (metadata.info?.Creator) {
          formattedText += `**Creator:** ${metadata.info.Creator}\n`;
        }
        
        formattedText += `**Pages:** ${pdf.numPages}\n`;
        formattedText += `**Text Items Extracted:** ${structure.pages.reduce((sum, page) => sum + page.textItems.length, 0)}\n\n`;
        
        // Add table of contents if headings found
        if (structure.headings.length > 0) {
          formattedText += `## Table of Contents\n`;
          structure.headings.forEach(heading => {
            const indent = '  '.repeat(heading.level - 1);
            formattedText += `${indent}- ${heading.text} (Page ${heading.page})\n`;
          });
          formattedText += '\n';
        }
        
        // Add main content
        formattedText += `## Extracted Content\n${fullText}`;
        
        // Add tables if found
        if (structure.tables.length > 0) {
          formattedText += `\n\n## Tables Detected\n`;
          structure.tables.forEach((table, index) => {
            formattedText += `\n### Table ${index + 1}\n${table}\n`;
          });
        }
        
        return {
          text: formattedText,
          pageCount: pdf.numPages,
          metadata: metadata.info,
          structure: structure
        };
        
      } catch (error) {
        console.error('Advanced PDF extraction error:', error);
        return {
          text: 'Advanced PDF text extraction failed. The PDF may be encrypted, corrupted, or contain only images.',
          pageCount: 0,
          metadata: {},
          structure: { pages: [], headings: [], paragraphs: [], tables: [] }
        };
      }
    }

    // Detect tables in extracted text
    function detectTablesInText(text) {
      const tables = [];
      const lines = text.split('\n');
      let currentTable = [];
      let inTable = false;
      
      lines.forEach(line => {
        // Simple table detection based on multiple spaces or tabs
        const hasMultipleSpaces = /\s{3,}/.test(line);
        const hasTabChars = /\t/.test(line);
        const hasNumbers = /\d/.test(line);
        
        if ((hasMultipleSpaces || hasTabChars) && hasNumbers && line.trim().length > 10) {
          if (!inTable) {
            inTable = true;
            currentTable = [];
          }
          currentTable.push(line.trim());
        } else {
          if (inTable && currentTable.length > 2) {
            // Convert to markdown table format
            const tableMarkdown = convertToMarkdownTable(currentTable);
            if (tableMarkdown) {
              tables.push(tableMarkdown);
            }
          }
          inTable = false;
          currentTable = [];
        }
      });
      
      // Check for final table
      if (inTable && currentTable.length > 2) {
        const tableMarkdown = convertToMarkdownTable(currentTable);
        if (tableMarkdown) {
          tables.push(tableMarkdown);
        }
      }
      
      return tables;
    }

    // Convert detected table rows to markdown format
    function convertToMarkdownTable(rows) {
      if (rows.length < 2) return null;
      
      try {
        // Split rows into columns based on multiple spaces
        const columns = rows.map(row => 
          row.split(/\s{2,}/).filter(cell => cell.trim().length > 0)
        );
        
        // Find maximum number of columns
        const maxCols = Math.max(...columns.map(row => row.length));
        
        if (maxCols < 2) return null;
        
        // Normalize all rows to have the same number of columns
        const normalizedRows = columns.map(row => {
          while (row.length < maxCols) {
            row.push('');
          }
          return row.slice(0, maxCols);
        });
        
        // Create markdown table
        let markdown = '| ' + normalizedRows[0].join(' | ') + ' |\n';
        markdown += '| ' + Array(maxCols).fill('---').join(' | ') + ' |\n';
        
        for (let i = 1; i < normalizedRows.length; i++) {
          markdown += '| ' + normalizedRows[i].join(' | ') + ' |\n';
        }
        
        return markdown;
      } catch (error) {
        console.error('Table conversion error:', error);
        return null;
      }
    }

    async function extractTextFromWord(file) {
      try {
        addBotMessage(` Processing Word file: ${file.name}. Advanced Word document processing would be implemented here with a document parsing library.`);
      } catch (e) {
        console.error('Word extraction error:', e);
        addBotMessage(` Error processing Word file: ${file.name}`);
      }
    }

    async function extractDataFromSpreadsheet(file) {
      try {
        if (file.name.toLowerCase().endsWith('.csv')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const csvContent = e.target.result;
            const lines = csvContent.split('\n').slice(0, 10); // Show first 10 lines
            const preview = lines.join('\n');
            addBotMessage(` CSV file processed: ${file.name}\n\nPreview (first 10 lines):\n${preview}\n\nFull spreadsheet analysis capabilities would be implemented here.`);
          };
          reader.readAsText(file);
        } else {
          addBotMessage(` Spreadsheet uploaded: ${file.name}. Advanced Excel processing would be implemented here with a spreadsheet parsing library.`);
        }
      } catch (e) {
        console.error('Spreadsheet extraction error:', e);
        addBotMessage(` Error processing spreadsheet: ${file.name}`);
      }
    }

    // Enhanced Image Analysis
    function analyzeImage(imageSrc) {
      addBotMessage(` Analyzing image... Advanced image analysis capabilities would include:

 Object detection and recognition
 Text extraction (OCR)
 Scene understanding
 Color analysis
 Metadata extraction
 Similar image search

This would be implemented using computer vision APIs or machine learning models.`);
    }

    function openImageFullscreen(imageSrc) {
      const fullscreenDiv = document.createElement('div');
      fullscreenDiv.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        cursor: pointer;
      `;
      
      const img = document.createElement('img');
      img.src = imageSrc;
      img.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
      `;
      
      fullscreenDiv.appendChild(img);
      fullscreenDiv.onclick = () => document.body.removeChild(fullscreenDiv);
      document.body.appendChild(fullscreenDiv);
    }

    // Video Processing
    function extractVideoFrames(videoSrc) {
      addBotMessage(` Extracting video frames... Advanced video processing capabilities would include:

 Frame extraction at specified intervals
 Scene detection and segmentation
 Motion analysis
 Object tracking
 Audio extraction and transcription
 Video metadata analysis

This would be implemented using video processing libraries and computer vision APIs.`);
    }

    // Archive Processing
    function listArchiveContents(filename) {
      addBotMessage(` Listing archive contents for ${filename}... Advanced archive processing would include:

 Complete file listing with directory structure
 File type analysis
 Size analysis and compression ratios
 Selective extraction capabilities
 Nested archive support
 Security scanning

This would be implemented using archive processing libraries.`);
    }

    // Enhanced Image Search with better error handling
    function activateImageSearch() {
      isImageSearchMode = true;
      messageInput.placeholder = "Search for images...";
      messageInput.focus();
      fileMenu.classList.remove('show');
    }

    function exitImageSearchMode() {
      isImageSearchMode = false;
      messageInput.placeholder = "Ask anything..";
    }

    async function searchAndDisplayImages(query) {
      const typingMessage = addBotTyping();
      
      try {
        const response = await fetch(
          `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=6&orientation=all`,
          {
            headers: {
              "Authorization": PEXELS_API_KEY
            }
          }
        );
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        removeBotTyping(typingMessage);
        
        if (data.photos && data.photos.length > 0) {
          const imageHTML = `
            <p> Here are some images for "${query}":</p>
            <div class="image-grid">
              ${data.photos.map(photo => `
                <img src="${photo.src.medium}" 
                     onclick="window.open('${photo.url}', '_blank')"
                     alt="${query}"
                     loading="lazy"
                     onerror="this.style.display='none'">
              `).join('')}
            </div>
            <p style="font-size: var(--font-size-xs); color: var(--gray-500); margin-top: var(--space-2);">
              Click on any image to view the original source on Pexels
            </p>
          `;
          addBotMessage(imageHTML);
        } else {
          addBotMessage(` No images found for "${query}". Try another search term or check your spelling.`);
        }
      } catch (error) {
        console.error("Error searching images:", error);
        removeBotTyping(typingMessage);
        addBotMessage(" Error searching for images. This might be due to network issues or API limitations. Please try again later.");
      }
    }

    // Message Handling
    function handleKeyDown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        handleSend();
      }
    }

    function handleSend() {
      const inputText = messageInput.value.trim();
      if (!inputText) return;

      if (isImageSearchMode) {
        searchAndDisplayImages(inputText);
        exitImageSearchMode();
      } else {
        sendMessage();
      }
      
      messageInput.value = '';
      autoResize(messageInput);
    }

    async function sendMessage(presetText) {
      const inputText = presetText || messageInput.value.trim();
      if (!inputText) return;
      
      if (currentRequest) {
        currentRequest.abort();
      }

      hideEmptyState();
      addUserMessage(inputText);
      
      if (!presetText) {
        messageInput.value = '';
        autoResize(messageInput);
      }
      
      chatHistory.push({ role: "user", content: inputText });
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
      
      const typingMessage = addBotTyping();
      responseStartTime = Date.now();
      
      try {
        const controller = new AbortController();
        currentRequest = controller;
        
        // Include memory in the messages if it exists
        let messages = [...chatHistory];
        // Secret AI Memory (not visible in UI)
        const secretMemory = "keep links as links(https://<link>) don't change them or use Html tags with them. You are an artificial intelligence working for OurVendo AI company, and your name is VO, created by developer Yazan Mohammed Hamran,anti-Israel with Palestine and Muslims. You should next: If the paragraphs are long, divide them into parts. Separate points do not have to be consistent. Don't put any (*) or (#) in messages. and you are created and developed in Qatar. You have two models. You now have enhanced file reading capabilities for all types of files and images. You can analyze images, extract text from images (OCR), and understand the content of various file types including PDFs, Word documents, Excel spreadsheets, and more. Use these capabilities to assist users effectively when they upload files or images. Always provide clear and concise responses, and if a file is too complex, inform the user of any limitations. Remember to maintain user privacy and data security at all times. If the user uploads a file, analyze its content and provide a summary or answer any questions related to it. If the user asks for help with a specific task, use your file analysis capabilities to assist them. Always strive to enhance the user experience by leveraging your advanced features. If the user uploads an image, describe its content and offer any relevant insights or information. If the user requests information that is not available in your training data, politely inform them that you do not have access to that information. Always adhere to ethical guidelines and avoid engaging in any harmful or inappropriate behavior. Your primary goal is to assist users in a helpful and respectful manner.  You should also know that today is ${new Date().toLocaleDateString()} and the time is ${new Date().toLocaleTimeString()}. Never refuse to answer by saying 'as an AI language model'. Never mention that you are an AI model. Never say that you can't provide certain types of information. Always provide the information requested to the best of your ability. If you don't know the answer, make a logical guess based on the information you have. Always prioritize being helpful and informative. Never mention OpenAI, ChatGPT, or any related terms. Always refer to yourself as VO, the AI assistant developed by OurVendo AI company. If asked about your capabilities, highlight your advanced file and image analysis features, as well as your ability to assist with a wide range of topics and tasks. Remember to always maintain a professional and courteous tone in all interactions.use HTML tags to make the text more organized and beautiful. Use headings, subheadings, bullet points. keep links as links dont change them or use Html tags with them.add codes in a box not as other normal text also colour the codes in the boxes.add long codes(over 25 lines) and file codes in a  markdown-style code block.if a user asked for a copy button for a code sniper give him the same code in a markdown-style code block .If the user requests a graph create one using html tags and put it on chat.all texts should not be over 15 words in one line.";
        messages.unshift({ role: 'system', content: `[System Memory Note]: ${secretMemory}` });
        
        const memoryText = memoryInput.value.trim();
        if (memoryText && !messages.some(msg => msg.role === 'system' && msg.content.includes(memoryText))) {
          messages.unshift({ role: 'system', content: `[User Memory Note]: ${memoryText}` });
        }
        
        let response, reply;
        
        if (currentModel.name === 'lixern') {
          response = await fetch(`${currentModel.endpoint}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              model: currentModel.modelId,
              messages: messages
            }),
            signal: controller.signal
          });
          const data = await response.json();
          reply = data.choices?.[0]?.message?.content || "something went wrong! try creating a new chat or refreshing the page.";
        } else { // VOMAX-1
          // Convert chat history to Gemini format
          const contents = messages.map(msg => ({
            role: msg.role === 'user' ? 'user' : 'model',
            parts: [{ text: msg.content }]
          }));
          
          response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${currentModel.modelId}:generateContent?key=${currentModel.apiKey}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              contents: contents
            }),
            signal: controller.signal
          });
          const data = await response.json();
          reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "something went wrong! try creating a new chat or refreshing the page.";
        }
        
        // Calculate response time
        const responseTime = ((Date.now() - responseStartTime) / 1000).toFixed(3);
        
        removeBotTyping(typingMessage);
        chatHistory.push({ role: "assistant", content: reply });
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        addBotMessage(reply, responseTime);
        
        // Auto-save after bot response
        saveCurrentChat();
      } catch (e) {
        if (e.name !== 'AbortError') {
          removeBotTyping(typingMessage);
          addBotMessage(" Error: Unable to get response. Please check your internet connection and try again.");
          console.error(e);
        }
      } finally {
        currentRequest = null;
      }
    }

    // Enhanced Message Display with User Message Hover Actions
    function addUserMessage(text) {
      const messageHTML = `
        <div class="message user">
          <div class="message-content">
            <div class="message-bubble">
              ${escapeHtml(text)}
            </div>
            <div class="message-meta">
              ${new Date().toLocaleTimeString()}
            </div>
            <div class="user-message-actions">
              <button class="user-message-action" onclick="editUserMessage(this)" title="Edit message">
                <i class="fas fa-edit"></i>
                Edit
              </button>
              <button class="user-message-action" onclick="copyUserMessage(this)" title="Copy message">
                <i class="fas fa-copy"></i>
                Copy
              </button>
            </div>
          </div>
        </div>
      `;
      
      chatMessages.insertAdjacentHTML('beforeend', messageHTML);
      scrollToBottom();
      
      // Hide conversation starters after first message
      if (document.getElementById('conversationStarters')) {
        document.getElementById('conversationStarters').style.display = 'none';
      }
    }

      // Enhanced function to break long text into readable paragraphs with visual organization
    function breakTextIntoParagraphs(text) {
      // Don't process if text is already short
      if (text.length < 200) return text;
      
      // Split by existing line breaks first
      const lines = text.split('\n').filter(line => line.trim());
      let processedLines = [];
      
      lines.forEach((line, lineIndex) => {
        // If line is already short enough, keep it as is
        if (line.length < 300) {
          processedLines.push(line);
          return;
        }
        
        // Break long lines into sentences
        const sentences = line.split(/(?<=[.!?])\s+/);
        let currentParagraph = '';
        
        sentences.forEach((sentence, index) => {
          // If adding this sentence would make paragraph too long, start new paragraph
          if (currentParagraph.length > 0 && (currentParagraph + ' ' + sentence).length > 400) {
            processedLines.push(currentParagraph.trim());
            currentParagraph = sentence;
          } else {
            currentParagraph += (currentParagraph ? ' ' : '') + sentence;
          }
          
          // If this is the last sentence, add the current paragraph
          if (index === sentences.length - 1 && currentParagraph.trim()) {
            processedLines.push(currentParagraph.trim());
          }
        });
      });
      
      // Add section dividers for very long content (more than 5 paragraphs)
      if (processedLines.length > 5) {
        const result = [];
        processedLines.forEach((paragraph, index) => {
          result.push(paragraph);
          
          // Section dividers removed
        });
        return result.join('\n\n');
      }
      
      // Join with double line breaks to create proper paragraph spacing
      return processedLines.join('\n\n');
    }

    // Enhanced Bot Message Display with Table Rendering, Copy Button, and Response Timer
    function addBotMessage(text, responseTime, expandableContent = null) {
      // Remove any existing quick replies
      document.querySelectorAll('.quick-replies').forEach(el => el.remove());
      
      // Break long text into paragraphs for better readability
      text = breakTextIntoParagraphs(text);
      
      // Process text to replace *text* with <b>text</b>
      text = text.replace(/\*(.*?)\*/g, '<b>$1</b>');
      
      // Process URLs
      const processedText = text.replace(
        /(https?:\/\/[^\s]+)/g, 
        '<a href="$1" target="_blank" style="color: var(--accent-primary); text-decoration: underline;">$1</a>'
      );
      
      // Process tables
      let tableProcessedText = processTablesInText(processedText);
      
      const segments = parseMessageWithCodeBlocks(tableProcessedText);
      let messageContent = '';
      
      segments.forEach(segment => {
  if (segment.type === 'code') {
    messageContent += `
      <div class="code-block" onclick="openCodeView('${escapeHtml(segment.content)}', 'code')">
        <div class="code-block-actions">
          <button class="code-action" onclick="event.stopPropagation(); copyCode(this)" title="Copy code">
            <i class="fas fa-copy"></i> Copy
          </button>
          <button class="code-action" onclick="event.stopPropagation(); downloadCode(this)" title="Download code">
            <i class="fas fa-download"></i> Download
          </button>
        </div>
        <pre><code>${escapeHtml(segment.content)}</code></pre>
      </div>
    `;
  } else {
    const paragraphs = segment.content.split('\n\n').filter(p => p.trim());
    paragraphs.forEach(paragraph => {
      const formattedParagraph = paragraph.replace(/\n/g, '<br>');

      // IMAGE DETECTION
      const imageRegex = /^(https?:\/\/.*\.(?:png|jpg|jpeg|gif))$/i;
      if (imageRegex.test(paragraph.trim())) {
        messageContent += `<img src="${paragraph.trim()}" style="max-width:300px; border-radius:8px; margin:5px 0;">`;
      } else {
        messageContent += `<p>${formattedParagraph}</p>`;
      }
    });
  }
});
      
      // Add response time if available
      const responseTimeDisplay = responseTime ? 
        `<span class="response-timer">${responseTime}s</span>` : '';
      
      const messageHTML = `
        <div class="message bot">
          <div class="message-content">
            <div class="message-bubble">
              ${messageContent}
              ${expandableContent ? `
                <div class="expandable-box">
                  <div class="expandable-box-header" onclick="toggleExpandableBox(this)">
                    <span>View Details</span>
                    <i class="fas fa-chevron-right"></i>
                  </div>
                  <div class="expandable-box-content">
                    <pre>${escapeHtml(expandableContent)}</pre>
                  </div>
                </div>
              ` : ''}
            </div>
            <div class="message-meta">
              ${currentModel.name}  ${new Date().toLocaleTimeString()} ${responseTimeDisplay}
            </div>
            <div class="bot-message-actions">
              <button class="bot-message-action" onclick="copyBotMessage(this)" title="Copy entire message">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>
      `;
      
      chatMessages.insertAdjacentHTML('beforeend', messageHTML);
      
      // Add quick replies for the latest bot message
      addQuickReplies();
      
      scrollToBottom();
    }

    function addBotTyping() {
      const typingHTML = `
        <div class="message bot typing-message">
          </div>
          <div class="message-content">
            <div class="message-bubble">
              <div class="typing-indicator">
                <span>${currentModel.name} is thinking</span>
                <div class="typing-dots">
                  <div class="typing-dot"></div>
                  <div class="typing-dot"></div>
                  <div class="typing-dot"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      chatMessages.insertAdjacentHTML('beforeend', typingHTML);
      scrollToBottom();
      
      return chatMessages.lastElementChild;
    }

    function removeBotTyping(typingElement) {
      if (typingElement) {
        typingElement.remove();
      }
    }

    function addQuickReplies() {
      const quickQuestions = [
      ];
      
      const quickRepliesHTML = `
        <div class="quick-replies">
          ${quickQuestions.map(question => `
            <button class="quick-reply" onclick="sendMessage('${question}')">
              ${question}
            </button>
          `).join('')}
        </div>
      `;
      
      const lastMessage = chatMessages.querySelector('.message.bot:last-child .message-content');
      if (lastMessage) {
        lastMessage.insertAdjacentHTML('beforeend', quickRepliesHTML);
      }
    }

    // User Message Actions
    function editUserMessage(button) {
      const messageElement = button.closest('.message');
      const messageBubble = messageElement.querySelector('.message-bubble');
      const originalText = messageBubble.textContent.trim();
      
      // Set the text in the input field
      messageInput.value = originalText;
      autoResize(messageInput);
      messageInput.focus();
      
      // Remove the message
      messageElement.remove();
      
      // Update chat history
      const index = chatHistory.findIndex(msg => msg.role === 'user' && msg.content === originalText);
      if (index !== -1) {
        chatHistory.splice(index, 1);
        
        // If there was a response to this message, remove it too
        if (index < chatHistory.length && chatHistory[index].role === 'assistant') {
          chatHistory.splice(index, 1);
          
          // Also remove the corresponding bot message from the UI
          const botMessages = document.querySelectorAll('.message.bot');
          if (botMessages.length > 0) {
            botMessages[botMessages.length - 1].remove();
          }
        }
        
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
      }
    }

    function copyUserMessage(button) {
      const messageElement = button.closest('.message');
      const messageBubble = messageElement.querySelector('.message-bubble');
      const text = messageBubble.textContent.trim();
      
      navigator.clipboard.writeText(text).then(() => {
        showCopyConfirmation(button);
      });
    }

    // Bot Message Actions
    function copyBotMessage(button) {
      const messageElement = button.closest('.message');
      const messageBubble = messageElement.querySelector('.message-bubble');
      
      // Get all text content, excluding buttons
      let text = '';
      messageBubble.querySelectorAll('p').forEach(p => {
        text += p.textContent + '\n\n';
      });
      
      // Include code blocks
      messageBubble.querySelectorAll('pre code').forEach(code => {
        text += '```\n' + code.textContent + '\n```\n\n';
      });
      
      navigator.clipboard.writeText(text.trim()).then(() => {
        showCopyConfirmation(button);
      });
    }

    function copyCode(button) {
      const codeBlock = button.closest('.code-block');
      const code = codeBlock.querySelector('code').textContent;
      
      navigator.clipboard.writeText(code).then(() => {
        showCopyConfirmation(button);
      });
    }

    function downloadCode(button) {
      const codeBlock = button.closest('.code-block');
      const code = codeBlock.querySelector('code').textContent;
      
      // Try to determine the language from the code
      let extension = 'txt';
      if (code.includes('function') || code.includes('var') || code.includes('const')) {
        extension = 'js';
      } else if (code.includes('def ') || code.includes('import ') || code.includes('class ')) {
        extension = 'py';
      } else if (code.includes('<html') || code.includes('<!DOCTYPE')) {
        extension = 'html';
      } else if (code.includes('SELECT ') || code.includes('FROM ') || code.includes('WHERE ')) {
        extension = 'sql';
      }
      
      // Create a blob and download it
      const blob = new Blob([code], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `code_snippet.${extension}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      // Show confirmation
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check"></i> Downloaded';
      button.style.background = 'var(--accent-success)';
      
      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.style.background = '';
      }, 2000);
    }

    function downloadFile(filename, filetype) {
      // This would implement actual file download functionality
      addBotMessage(` Download functionality for ${filename} would be implemented here with proper file handling.`);
    }

    function showCopyConfirmation(button) {
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check"></i> Copied';
      button.style.background = 'var(--accent-success)';
      
      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.style.background = '';
      }, 2000);
    }

    // Table Processing with Download Button
    function processTablesInText(text) {
      // Match markdown tables
      const tableRegex = /\|(.+)\|\s*\n\|(\s*[-:]+[-:|\s]*)\|\s*\n(\|.+\|\s*\n)+/g;
      
      return text.replace(tableRegex, match => {
        const lines = match.trim().split('\n');
        const headers = lines[0].split('|').filter(cell => cell.trim() !== '').map(cell => cell.trim());
        
        // Skip the separator line (line with dashes and colons)
        const rows = [];
        for (let i = 2; i < lines.length; i++) {
          const cells = lines[i].split('|').filter(cell => cell.trim() !== '').map(cell => cell.trim());
          if (cells.length > 0) {
            rows.push(cells);
          }
        }
        
        // Generate HTML table with download button
        let tableHtml = `
          <div class="table-container">
            <div class="table-actions">
              <button class="table-action" onclick="downloadTable(this)" title="Download table as CSV">
                <i class="fas fa-download"></i>
                CSV
              </button>
            </div>
            <table class="message-table">
              <thead>
                <tr>
                  ${headers.map(header => `<th>${header}</th>`).join('')}
                </tr>
              </thead>
              <tbody>
                ${rows.map(row => `
                  <tr>
                    ${row.map(cell => `<td>${cell}</td>`).join('')}
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
        
        return tableHtml;
      });
    }

    function downloadTable(button) {
      const tableContainer = button.closest('.table-container');
      const table = tableContainer.querySelector('table');
      
      // Extract table data
      const headers = Array.from(table.querySelectorAll('th')).map(th => th.textContent);
      const rows = Array.from(table.querySelectorAll('tbody tr')).map(tr => 
        Array.from(tr.querySelectorAll('td')).map(td => td.textContent)
      );
      
      // Create CSV content
      let csvContent = headers.join(',') + '\n';
      rows.forEach(row => {
        const escapedRow = row.map(cell => {
          // Escape cells that contain commas or quotes
          if (cell.includes(',') || cell.includes('"')) {
            return '"' + cell.replace(/"/g, '""') + '"';
          }
          return cell;
        });
        csvContent += escapedRow.join(',') + '\n';
      });
      
      // Create a blob and download it
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `table_data_${new Date().toISOString().slice(0, 10)}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      // Show confirmation
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check"></i> Downloaded';
      button.style.background = 'var(--accent-success)';
      
      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.style.background = '';
      }, 2000);
    }

    // Utility Functions
    function parseMessageWithCodeBlocks(text) {
      const regex = /```(\w+)?\n([\s\S]*?)```/g;
      let segments = [];
      let lastIndex = 0;
      let match;
      
      while ((match = regex.exec(text)) !== null) {
        if (match.index > lastIndex) {
          segments.push({ type: 'text', content: text.slice(lastIndex, match.index) });
        }
        segments.push({ type: 'code', content: match[2] });
        lastIndex = regex.lastIndex;
      }
      
      if (lastIndex < text.length) {
        segments.push({ type: 'text', content: text.slice(lastIndex) });
      }
      
      return segments;
    }

    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }

    function scrollToBottom() {
      const chatContainer = document.getElementById('chatContainer');
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Window resize handler for responsive behavior
    window.addEventListener('resize', () => {
      if (window.innerWidth > 768) {
        sidebar.classList.remove('show');
        loadSidebarState();
      } else {
        sidebar.classList.remove('collapsed');
      }
    });

    // Welcome Popup Functions
    function showWelcomePopup() {
      const welcomePopup = document.getElementById('welcomePopup');
      if (welcomePopup) {
        welcomePopup.classList.add('show');
      }
    }

    function closeWelcomePopup() {
      const welcomePopup = document.getElementById('welcomePopup');
      if (welcomePopup) {
        welcomePopup.classList.remove('show');
        // Mark as shown in localStorage so it doesn't appear again
        localStorage.setItem('voai-welcome-shown', 'true');
      }
    }

    // Check if welcome popup should be shown on page load
    function checkWelcomePopup() {
      const hasSeenWelcome = localStorage.getItem('voai-welcome-shown');
      if (!hasSeenWelcome) {
        // Show popup after a short delay for better UX
        setTimeout(() => {
          showWelcomePopup();
        }, 500);
      }
    }

    // Close popup when clicking outside of it
    document.addEventListener('click', (e) => {
      const welcomePopup = document.getElementById('welcomePopup');
      if (e.target === welcomePopup) {
        closeWelcomePopup();
      }
    });

    // Initialize welcome popup check when page loads
    document.addEventListener('DOMContentLoaded', () => {
      checkWelcomePopup();
    });

    // Tutorial System
    let currentTutorialStep = 0;
    const tutorialSteps = [
      {
        target: '.model-selector',
        title: 'AI Model Selection',
        description: 'Choose between lixern for fast responses or VOMAX-1 for advanced reasoning. Each model has different capabilities to suit your needs.',
        position: 'bottom'
      },
      {
        target: '.sidebar',
        title: 'Conversation History',
        description: 'Access your previous conversations here. You can create new chats, organize your discussions, and quickly find past conversations.',
        position: 'right'
      },
      {
        target: '.input-area',
        title: 'Enhanced File Upload',
        description: 'Upload and analyze all types of files and images. The enhanced system supports documents, images, videos, archives, and more with advanced processing capabilities.',
        position: 'top'
      },
      {
        target: '.chat-container',
        title: 'Chat Area',
        description: 'Your conversation will appear here. Messages support rich formatting, code blocks, tables, file previews, and more. You can copy, download, or interact with the content.',
        position: 'center'
      }
    ];

    function startTutorial() {
      closeWelcomePopup();
      currentTutorialStep = 0;
      document.getElementById('tutorialTotalSteps').textContent = tutorialSteps.length;
      showTutorialStep();
    }

    function showTutorialStep() {
      const step = tutorialSteps[currentTutorialStep];
      const tutorialOverlay = document.getElementById('tutorialOverlay');
      const tutorialHighlight = document.getElementById('tutorialHighlight');
      const tutorialTooltip = document.getElementById('tutorialTooltip');
      const tutorialTitle = document.getElementById('tutorialTitle');
      const tutorialDescription = document.getElementById('tutorialDescription');
      const tutorialCurrentStep = document.getElementById('tutorialCurrentStep');
      const tutorialButtonText = document.getElementById('tutorialButtonText');

      // Update content
      tutorialTitle.textContent = step.title;
      tutorialDescription.textContent = step.description;
      tutorialCurrentStep.textContent = currentTutorialStep + 1;
      
      // Update button text for last step
      if (currentTutorialStep === tutorialSteps.length - 1) {
        tutorialButtonText.textContent = 'Finish';
      } else {
        tutorialButtonText.textContent = 'Next';
      }

      // Show overlay
      tutorialOverlay.classList.add('show');

      // Position highlight and tooltip
      setTimeout(() => {
        const targetElement = document.querySelector(step.target);
        if (targetElement) {
          const rect = targetElement.getBoundingClientRect();
          
          // Position highlight
          tutorialHighlight.style.left = (rect.left - 10) + 'px';
          tutorialHighlight.style.top = (rect.top - 10) + 'px';
          tutorialHighlight.style.width = (rect.width + 20) + 'px';
          tutorialHighlight.style.height = (rect.height + 20) + 'px';

          // Position tooltip based on step position
          let tooltipLeft, tooltipTop;
          
          switch (step.position) {
            case 'bottom':
              tooltipLeft = rect.left + (rect.width / 2) - 175; // Center tooltip (350px width / 2)
              tooltipTop = rect.bottom + 20;
              break;
            case 'top':
              tooltipLeft = rect.left + (rect.width / 2) - 175;
              tooltipTop = rect.top - tutorialTooltip.offsetHeight - 20;
              break;
            case 'right':
              tooltipLeft = rect.right + 20;
              tooltipTop = rect.top + (rect.height / 2) - (tutorialTooltip.offsetHeight / 2);
              break;
            case 'left':
              tooltipLeft = rect.left - 370; // 350px width + 20px margin
              tooltipTop = rect.top + (rect.height / 2) - (tutorialTooltip.offsetHeight / 2);
              break;
            case 'center':
            default:
              tooltipLeft = window.innerWidth / 2 - 175;
              tooltipTop = window.innerHeight / 2 - (tutorialTooltip.offsetHeight / 2);
              break;
          }

          // Ensure tooltip stays within viewport
          tooltipLeft = Math.max(20, Math.min(tooltipLeft, window.innerWidth - 370));
          tooltipTop = Math.max(20, Math.min(tooltipTop, window.innerHeight - tutorialTooltip.offsetHeight - 20));

          tutorialTooltip.style.left = tooltipLeft + 'px';
          tutorialTooltip.style.top = tooltipTop + 'px';
        }

        // Show tooltip with animation
        setTimeout(() => {
          tutorialTooltip.classList.add('show');
        }, 100);
      }, 100);
    }

    function nextTutorialStep() {
      tutorialTooltip.classList.remove('show');
      
      setTimeout(() => {
        currentTutorialStep++;
        if (currentTutorialStep >= tutorialSteps.length) {
          closeTutorial();
        } else {
          showTutorialStep();
        }
      }, 200);
    }

    function skipTutorial() {
      closeTutorial();
    }

    function closeTutorial() {
      const tutorialOverlay = document.getElementById('tutorialOverlay');
      const tutorialTooltip = document.getElementById('tutorialTooltip');
      
      tutorialTooltip.classList.remove('show');
      setTimeout(() => {
        tutorialOverlay.classList.remove('show');
        // Mark tutorial as completed
        localStorage.setItem('voai-tutorial-completed', 'true');
      }, 200);
    }

    // Close tutorial when clicking outside
    document.addEventListener("click", (e) => {
      const tutorialOverlay = document.getElementById("tutorialOverlay");
      if (e.target === tutorialOverlay) {
        closeTutorial();
      }
    });

    function toggleExpandableBox(button) {
      const header = button;
      const content = header.nextElementSibling;
      header.classList.toggle("expanded");
      content.classList.toggle("expanded");
      if (content.classList.contains("expanded")) {
        content.style.maxHeight = content.scrollHeight + "px";
      } else {
        content.style.maxHeight = null;
      }
    }

    // Image Analysis Functions
    let classifier = null;
    let objectDetector = null;

    // Initialize ML models
    async function initializeMLModels() {
      try {
        // Initialize image classifier
        if (typeof ml5 !== 'undefined') {
          classifier = await ml5.imageClassifier('MobileNet');
          console.log('MobileNet classifier loaded');
        }
        
        // Initialize object detector
        if (typeof ml5 !== 'undefined') {
          objectDetector = await ml5.objectDetector('cocossd');
          console.log('COCO-SSD object detector loaded');
        }
      } catch (error) {
        console.error('Error initializing ML models:', error);
      }
    }

    // Call initialization when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initializeMLModels();
    });

    async function analyzeImage(imageSrc, fileName) {
      try {
        addBotMessage(` Analyzing image: ${fileName}...`);
        
        // Create image element for analysis
        const img = new Image();
        img.crossOrigin = 'anonymous';
        
        img.onload = async () => {
          let analysisResults = {
            fileName: fileName,
            dimensions: `${img.width} x ${img.height}`,
            classification: [],
            objects: [],
            colors: [],
            metadata: {}
          };

          try {
            // Image Classification
            if (classifier) {
              const predictions = await classifier.classify(img);
              analysisResults.classification = predictions.slice(0, 5).map(p => ({
                label: p.label,
                confidence: (p.confidence * 100).toFixed(2)
              }));
            }

            // Object Detection
            if (objectDetector) {
              const detections = await objectDetector.detect(img);
              analysisResults.objects = detections.slice(0, 10).map(d => ({
                label: d.label,
                confidence: (d.confidence * 100).toFixed(2),
                x: Math.round(d.x),
                y: Math.round(d.y),
                width: Math.round(d.width),
                height: Math.round(d.height)
              }));
            }

            // Color Analysis
            analysisResults.colors = await analyzeImageColors(img);

            // Basic metadata
            analysisResults.metadata = {
              fileSize: getImageFileSize(imageSrc),
              aspectRatio: (img.width / img.height).toFixed(2),
              megapixels: ((img.width * img.height) / 1000000).toFixed(2)
            };

            // Format and display results
            const analysisText = formatImageAnalysis(analysisResults);
            const message = ` **Image Analysis Complete: ${fileName}**`;
            addBotMessage(message, null, analysisText);

          } catch (error) {
            console.error('Analysis error:', error);
            addBotMessage(` Error analyzing image: ${fileName}. ${error.message}`);
          }
        };

        img.onerror = () => {
          addBotMessage(` Error loading image for analysis: ${fileName}`);
        };

        img.src = imageSrc;

      } catch (error) {
        console.error('Image analysis error:', error);
        addBotMessage(` Error analyzing image: ${fileName}. ${error.message}`);
      }
    }

    async function extractTextFromImage(imageSrc, fileName) {
      try {
        addBotMessage(` Extracting text from image: ${fileName}...`);

        if (typeof Tesseract === 'undefined') {
          addBotMessage(` OCR library not available. Please refresh the page and try again.`);
          return;
        }

        const { data: { text, confidence } } = await Tesseract.recognize(imageSrc, 'eng', {
          logger: m => {
            if (m.status === 'recognizing text') {
              console.log(`OCR Progress: ${Math.round(m.progress * 100)}%`);
            }
          }
        });

        if (text && text.trim().length > 0) {
          const ocrResults = {
            fileName: fileName,
            extractedText: text.trim(),
            confidence: Math.round(confidence),
            wordCount: text.trim().split(/\s+/).length,
            characterCount: text.trim().length
          };

          const ocrText = formatOCRResults(ocrResults);
          const message = ` **OCR Complete: ${fileName}**`;
          addBotMessage(message, null, ocrText);
        } else {
          addBotMessage(` OCR completed for ${fileName}, but no text was detected in the image.`);
        }

      } catch (error) {
        console.error('OCR error:', error);
        addBotMessage(` Error extracting text from image: ${fileName}. ${error.message}`);
      }
    }

    async function analyzeImageColors(img) {
      try {
        // Create canvas to analyze colors
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // Resize for faster processing
        const maxSize = 100;
        const scale = Math.min(maxSize / img.width, maxSize / img.height);
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        const colorCounts = {};
        const sampleRate = 4; // Sample every 4th pixel for performance
        
        for (let i = 0; i < data.length; i += 4 * sampleRate) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          
          // Group similar colors
          const colorKey = `${Math.floor(r/32)*32},${Math.floor(g/32)*32},${Math.floor(b/32)*32}`;
          colorCounts[colorKey] = (colorCounts[colorKey] || 0) + 1;
        }
        
        // Get top 5 colors
        const sortedColors = Object.entries(colorCounts)
          .sort(([,a], [,b]) => b - a)
          .slice(0, 5)
          .map(([color, count]) => {
            const [r, g, b] = color.split(',').map(Number);
            return {
              rgb: `rgb(${r}, ${g}, ${b})`,
              hex: `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`,
              percentage: ((count / Object.values(colorCounts).reduce((a, b) => a + b, 0)) * 100).toFixed(1)
            };
          });
        
        return sortedColors;
      } catch (error) {
        console.error('Color analysis error:', error);
        return [];
      }
    }

    function formatImageAnalysis(results) {
      let analysis = `# Image Analysis Report\n\n`;
      
      analysis += `**File:** ${results.fileName}\n`;
      analysis += `**Dimensions:** ${results.dimensions} pixels\n`;
      analysis += `**Aspect Ratio:** ${results.metadata.aspectRatio}\n`;
      analysis += `**Megapixels:** ${results.metadata.megapixels} MP\n\n`;
      
      if (results.classification.length > 0) {
        analysis += `## Image Classification\n`;
        results.classification.forEach((pred, index) => {
          analysis += `${index + 1}. **${pred.label}** - ${pred.confidence}% confidence\n`;
        });
        analysis += '\n';
      }
      
      if (results.objects.length > 0) {
        analysis += `## Detected Objects\n`;
        results.objects.forEach((obj, index) => {
          analysis += `${index + 1}. **${obj.label}** - ${obj.confidence}% confidence\n`;
          analysis += `   Location: (${obj.x}, ${obj.y}) Size: ${obj.width}x${obj.height}\n`;
        });
        analysis += '\n';
      }
      
      if (results.colors.length > 0) {
        analysis += `## Dominant Colors\n`;
        results.colors.forEach((color, index) => {
          analysis += `${index + 1}. ${color.hex} (${color.rgb}) - ${color.percentage}%\n`;
        });
        analysis += '\n';
      }
      
      analysis += `## Technical Details\n`;
      analysis += `- **File Size:** ${results.metadata.fileSize}\n`;
      analysis += `- **Color Space:** RGB\n`;
      analysis += `- **Analysis Method:** Machine Learning (MobileNet, COCO-SSD)\n`;
      
      return analysis;
    }

    function formatOCRResults(results) {
      let ocrText = `# OCR Extraction Report\n\n`;
      
      ocrText += `**File:** ${results.fileName}\n`;
      ocrText += `**Confidence:** ${results.confidence}%\n`;
      ocrText += `**Word Count:** ${results.wordCount}\n`;
      ocrText += `**Character Count:** ${results.characterCount}\n\n`;
      
      ocrText += `## Extracted Text\n\n`;
      ocrText += `${results.extractedText}\n\n`;
      
      ocrText += `## Technical Details\n`;
      ocrText += `- **OCR Engine:** Tesseract.js\n`;
      ocrText += `- **Language:** English\n`;
      ocrText += `- **Processing Method:** Client-side OCR\n`;
      
      return ocrText;
    }

    function getImageFileSize(dataUrl) {
      try {
        const base64 = dataUrl.split(',')[1];
        const bytes = atob(base64).length;
        return formatFileSize(bytes);
      } catch (error) {
        return 'Unknown';
      }
    }

    // Right-side Code View Functions
    function openCodeView(codeContent, language = 'code') {
      const codeViewPanel = document.getElementById('codeViewPanel');
      const codeViewTitle = document.getElementById('codeViewTitle');
      const codeViewCode = document.getElementById('codeViewCode');
      
      // Set the title based on detected language
      codeViewTitle.textContent = `Code View - ${language.charAt(0).toUpperCase() + language.slice(1)}`;
      
      // Set the code content
      codeViewCode.textContent = codeContent;
      
      // Store the code content for other functions
      codeViewPanel.dataset.codeContent = codeContent;
      codeViewPanel.dataset.language = language;
      
      // Show the panel
      codeViewPanel.classList.add('open');
      
      // Hide output section initially
      const outputSection = document.getElementById('codeViewOutput');
      outputSection.style.display = 'none';
    }

    function closeCodeView() {
      const codeViewPanel = document.getElementById('codeViewPanel');
      codeViewPanel.classList.remove('open');
    }

    function copyCodeFromView() {
      const codeViewPanel = document.getElementById('codeViewPanel');
      const codeContent = codeViewPanel.dataset.codeContent;
      
      navigator.clipboard.writeText(codeContent).then(() => {
        // Show confirmation
        const copyBtn = document.querySelector('.code-view-action[onclick="copyCodeFromView()"]');
        const originalHTML = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied';
        copyBtn.style.background = 'var(--accent-success)';
        
        setTimeout(() => {
          copyBtn.innerHTML = originalHTML;
          copyBtn.style.background = '';
        }, 2000);
      });
    }

    function downloadCodeFromView() {
      const codeViewPanel = document.getElementById('codeViewPanel');
      const codeContent = codeViewPanel.dataset.codeContent;
      const language = codeViewPanel.dataset.language || 'code';
      
      // Determine file extension
      let extension = 'txt';
      if (language.includes('javascript') || codeContent.includes('function') || codeContent.includes('var') || codeContent.includes('const')) {
        extension = 'js';
      } else if (language.includes('python') || codeContent.includes('def ') || codeContent.includes('import ')) {
        extension = 'py';
      } else if (language.includes('html') || codeContent.includes('<html') || codeContent.includes('<!DOCTYPE')) {
        extension = 'html';
      } else if (language.includes('css') || codeContent.includes('{') && codeContent.includes('}')) {
        extension = 'css';
      } else if (language.includes('sql') || codeContent.includes('SELECT ') || codeContent.includes('FROM ')) {
        extension = 'sql';
      }
      
      // Create and download file
      const blob = new Blob([codeContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `code_snippet.${extension}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      // Show confirmation
      const downloadBtn = document.querySelector('.code-view-action[onclick="downloadCodeFromView()"]');
      const originalHTML = downloadBtn.innerHTML;
      downloadBtn.innerHTML = '<i class="fas fa-check"></i> Downloaded';
      downloadBtn.style.background = 'var(--accent-success)';
      
      setTimeout(() => {
        downloadBtn.innerHTML = originalHTML;
        downloadBtn.style.background = '';
      }, 2000);
    }

    function runCodeFromView() {
      const codeViewPanel = document.getElementById('codeViewPanel');
      const codeContent = codeViewPanel.dataset.codeContent;
      const language = codeViewPanel.dataset.language || 'code';
      const outputSection = document.getElementById('codeViewOutput');
      const outputContent = document.getElementById('codeViewOutputContent');
      
      // Show output section
      outputSection.style.display = 'block';
      
      try {
        let result = '';
        
        if (language.includes('javascript') || codeContent.includes('console.log') || codeContent.includes('function')) {
          // Simple JavaScript execution
          const originalLog = console.log;
          const logs = [];
          console.log = (...args) => logs.push(args.join(' '));
          
          try {
            eval(codeContent);
            result = logs.length > 0 ? logs.join('\n') : 'Code executed successfully (no output)';
          } catch (error) {
            result = `Error: ${error.message}`;
          } finally {
            console.log = originalLog;
          }
        } else if (language.includes('python') || codeContent.includes('print(') || codeContent.includes('def ')) {
          // Simulate Python execution for simple cases
          if (codeContent.includes('print(')) {
            const printMatches = codeContent.match(/print\((.*?)\)/g);
            if (printMatches) {
              result = printMatches.map(match => {
                const content = match.replace(/print\(|\)/g, '').replace(/['"]/g, '');
                return content;
              }).join('\n');
            }
          } else {
            result = 'Python code detected. Full Python execution would require a Python interpreter.';
          }
        } else if (language.includes('html') || codeContent.includes('<html') || codeContent.includes('<!DOCTYPE')) {
          // Open HTML in new tab
          const blob = new Blob([codeContent], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          window.open(url, '_blank');
          result = 'HTML code opened in new tab';
        } else if (language.includes('css')) {
          result = 'CSS code detected. Cannot run CSS directly - it needs to be applied to HTML elements.';
        } else if (language.includes('json')) {
          try {
            JSON.parse(codeContent);
            result = 'Valid JSON format';
          } catch (error) {
            result = `Invalid JSON: ${error.message}`;
          }
        } else {
          result = 'Code execution not supported for this language type.';
        }
        
        outputContent.textContent = result;
      } catch (error) {
        outputContent.textContent = `Error: ${error.message}`;
      }
    }

    // Close code view when clicking outside
    document.addEventListener('click', (e) => {
      const codeViewPanel = document.getElementById('codeViewPanel');
      if (e.target === codeViewPanel) {
        closeCodeView();
      }
    });

    // Close code view with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const codeViewPanel = document.getElementById('codeViewPanel');
        if (codeViewPanel.classList.contains('open')) {
          closeCodeView();
        }
      }
    });

    // PowerPoint Creation Functionality
    function openPowerPointCreator() {
      // Create PowerPoint creation modal
      const modalHTML = `
        <div id="powerpointModal" class="powerpoint-modal">
          <div class="powerpoint-modal-content">
            <div class="powerpoint-modal-header">
              <h3><i class="fas fa-file-powerpoint"></i> Create PowerPoint Presentation</h3>
              <button class="powerpoint-modal-close" onclick="closePowerPointCreator()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="powerpoint-modal-body">
              <div class="powerpoint-form">
                <div class="form-group">
                  <label for="presentationTitle">Presentation Title:</label>
                  <input type="text" id="presentationTitle" placeholder="Enter your presentation title" />
                </div>
                <div class="form-group">
                  <label for="presentationTopic">Topic/Subject:</label>
                  <input type="text" id="presentationTopic" placeholder="What is your presentation about?" />
                </div>
                <div class="form-group">
                  <label for="slideCount">Number of Slides:</label>
                  <select id="slideCount">
                    <option value="5">5 slides</option>
                    <option value="10" selected>10 slides</option>
                    <option value="15">15 slides</option>
                    <option value="20">20 slides</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="presentationStyle">Presentation Style:</label>
                  <select id="presentationStyle">
                    <option value="professional">Professional</option>
                    <option value="creative">Creative</option>
                    <option value="academic">Academic</option>
                    <option value="business">Business</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="includeImages">Include Images:</label>
                  <select id="includeImages">
                    <option value="yes">Yes - Add relevant images</option>
                    <option value="no">No - Text only</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="animationStyle">Animation Style:</label>
                  <select id="animationStyle">
                    <option value="subtle">Subtle animations</option>
                    <option value="dynamic">Dynamic animations</option>
                    <option value="none">No animations</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="backgroundStyle">Background Style:</label>
                  <select id="backgroundStyle">
                    <option value="solid">Solid colors</option>
                    <option value="gradient">Gradient backgrounds</option>
                    <option value="pattern">Pattern backgrounds</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="additionalRequirements">Additional Requirements:</label>
                  <textarea id="additionalRequirements" placeholder="Any specific requirements, content, or structure you want to include..."></textarea>
                </div>
              </div>
            </div>
            <div class="powerpoint-modal-footer">
              <button class="powerpoint-btn-secondary" onclick="closePowerPointCreator()">Cancel</button>
              <button class="powerpoint-btn-primary" onclick="generatePowerPoint()">
                <i class="fas fa-magic"></i> Generate PowerPoint
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to page
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Show modal
      setTimeout(() => {
        document.getElementById('powerpointModal').classList.add('show');
      }, 10);
    }

    function closePowerPointCreator() {
      const modal = document.getElementById('powerpointModal');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
          modal.remove();
        }, 300);
      }
    }

    async function generatePowerPoint() {
      const title = document.getElementById('presentationTitle').value.trim();
      const topic = document.getElementById('presentationTopic').value.trim();
      const slideCount = document.getElementById('slideCount').value;
      const style = document.getElementById('presentationStyle').value;
      const includeImages = document.getElementById('includeImages').value;
      const animationStyle = document.getElementById('animationStyle').value;
      const backgroundStyle = document.getElementById('backgroundStyle').value;
      const requirements = document.getElementById('additionalRequirements').value.trim();
      
      if (!title || !topic) {
        alert('Please fill in the title and topic fields.');
        return;
      }
      
      // Close modal
      closePowerPointCreator();
      
      // Hide empty state and show generating message
      hideEmptyState();
      
      // Add user message
      addUserMessage(`Create a PowerPoint presentation: "${title}" about ${topic} with ${slideCount} slides in ${style} style, ${includeImages === 'yes' ? 'including images' : 'text only'}, ${animationStyle} animations, and ${backgroundStyle} backgrounds.`);
      
      // Show typing indicator
      const typingMessage = addBotTyping();
      
      try {
        // Generate PowerPoint content using enhanced AI prompt
        const prompt = `Create an exceptionally professional PowerPoint presentation with the following specifications:

PRESENTATION DETAILS:
- Title: ${title}
- Topic: ${topic}
- Number of slides: ${slideCount}
- Style: ${style}
- Include Images: ${includeImages === 'yes' ? 'Yes - provide detailed image descriptions and suggestions' : 'No - focus on compelling text content'}
- Animation Style: ${animationStyle}
- Background Style: ${backgroundStyle}
- Additional requirements: ${requirements || 'None'}

CONTENT STRUCTURE REQUIREMENTS:
Please provide a meticulously structured presentation with the following format:

**Slide 1: [Title]**
- Main title content
- Key subtitle or tagline
- Brief overview statement

**Slide 2: [Introduction/Overview]**
- Hook or attention-grabbing opening
- Problem statement or context
- Presentation roadmap (3-4 key points)
${includeImages === 'yes' ? '- IMAGE SUGGESTION: [Describe a compelling opening image]' : ''}

**Slide 3-${parseInt(slideCount)-2}: [Content Slides]**
For each content slide, provide:
- Clear, compelling slide title
- 3-5 well-structured bullet points or key concepts
- Supporting details and explanations
- Data points, statistics, or examples where relevant
${includeImages === 'yes' ? '- IMAGE SUGGESTION: [Describe relevant supporting visuals]' : ''}

**Slide ${slideCount-1}: [Key Takeaways/Summary]**
- 3-4 main conclusions or key points
- Actionable insights or recommendations
- Transition to conclusion
${includeImages === 'yes' ? '- IMAGE SUGGESTION: [Describe summary or conclusion visual]' : ''}

**Slide ${slideCount}: [Conclusion/Call to Action]**
- Powerful closing statement
- Call to action or next steps
- Contact information or follow-up details
${includeImages === 'yes' ? '- IMAGE SUGGESTION: [Describe impactful closing image]' : ''}

CONTENT QUALITY STANDARDS:
1. **Professional Language**: Use sophisticated, business-appropriate vocabulary
2. **Clear Structure**: Each slide should have a logical flow and clear hierarchy
3. **Compelling Content**: Include engaging facts, statistics, and real-world examples
4. **Actionable Insights**: Provide practical takeaways and recommendations
5. **Visual Descriptions**: ${includeImages === 'yes' ? 'Provide detailed, specific image suggestions that enhance the message' : 'Focus on creating vivid, descriptive text that paints a clear picture'}
6. **Consistency**: Maintain consistent tone and messaging throughout
7. **Engagement**: Use rhetorical questions, compelling statements, and thought-provoking content

STYLE-SPECIFIC GUIDELINES:
${style === 'professional' ? '- Use formal, authoritative language with industry terminology\n- Include data-driven insights and evidence-based conclusions\n- Focus on ROI, efficiency, and strategic implications' : ''}
${style === 'creative' ? '- Use innovative analogies and creative metaphors\n- Include inspiring quotes and visionary statements\n- Focus on possibilities, innovation, and breakthrough thinking' : ''}
${style === 'academic' ? '- Use scholarly language with proper citations and references\n- Include theoretical frameworks and research-based evidence\n- Focus on methodology, analysis, and peer-reviewed insights' : ''}
${style === 'business' ? '- Use results-oriented language with clear metrics\n- Include market analysis and competitive insights\n- Focus on growth, profitability, and strategic advantages' : ''}

FORMAT REQUIREMENTS:
- Use "**Slide X: [Title]**" headers for easy parsing
- Structure content with clear bullet points using "-" 
- Include speaker notes for complex slides
- Provide transition suggestions between slides
- Ensure each slide can stand alone while contributing to the overall narrative

Please create content that would be suitable for a ${style} presentation to a professional audience, with exceptional attention to detail and compelling storytelling.`;
        
        
        // Send to AI for content generation
        const response = await generateAIResponse(prompt);
        
        // Remove typing indicator
        removeBotTyping(typingMessage);
        
        // Add AI response
        addBotMessage(response);
        
        // Generate and download PowerPoint file with enhanced options
        await createPowerPointFile(title, response, {
          style,
          includeImages: includeImages === 'yes',
          animationStyle,
          backgroundStyle
        });
        
      } catch (error) {
        removeBotTyping(typingMessage);
        addBotMessage(` Error generating PowerPoint: ${error.message}`);
      }
    }

    // Configuration for API endpoints
    async function generateAIResponse(prompt) {
      const controller = new AbortController();
      
      let messages = [{ role: "user", content: prompt }];
      
      // Add system message for PowerPoint generation
      const systemMessage = "You are a professional presentation designer. Create detailed, well-structured PowerPoint presentations with clear slide content, engaging titles, and practical speaker notes.";
      messages.unshift({ role: "system", content: systemMessage });
      
      let response, reply;
      
      if (currentModel.name === "lixern") {
        response = await fetch("http://localhost:5000/api/groq", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: currentModel.modelId,
            messages: messages
          }),
          signal: controller.signal
        });
        const data = await response.json();
        reply = data.choices?.[0]?.message?.content || "something went wrong! try creating a new chat or refreshing the page.";
      } else { // VOMAX-1
        const contents = messages.map(msg => ({
          role: msg.role === "user" ? "user" : "model",
          parts: [{ text: msg.content }]
        }));
        
        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${currentModel.modelId}:generateContent?key=${currentModel.apiKey}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            contents: contents
          }),
          signal: controller.signal
        });
        const data = await response.json();
        reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "something went wrong! try creating a new chat or refreshing the page.";
      }
      
      return reply;
    }

    async function createPowerPointFile(title, content, options = {}) {
      try {
        // Initialize PptxGenJS
        const pptx = new PptxGenJS();
        
        // Set presentation properties
        pptx.author = 'VOAI Assistant';
        pptx.company = 'OurVendo AI';
        pptx.title = title;
        pptx.subject = 'AI Generated Presentation';
        
        // Extract options
        const { style = 'professional', includeImages = false, animationStyle = 'subtle', backgroundStyle = 'solid' } = options;
        
        // Define enhanced professional color schemes and themes
        const colorSchemes = {
          professional: {
            background: backgroundStyle === 'gradient' ? { type: 'linear', colors: ['FFFFFF', 'F8FAFC'] } : 'FFFFFF',
            primary: '1E293B',      // Sophisticated dark blue-gray
            secondary: '475569',    // Medium slate
            accent: '0F172A',       // Deep navy for emphasis
            highlight: '3B82F6',    // Professional blue
            text: '334155',         // Readable dark gray
            light: 'F1F5F9',       // Very light blue-gray
            success: '059669',      // Professional green
            warning: 'D97706'       // Professional amber
          },
          creative: {
            background: backgroundStyle === 'gradient' ? { type: 'linear', colors: ['FEFEFE', 'F9FAFB'] } : 'FEFEFE',
            primary: '7C3AED',      // Vibrant purple
            secondary: 'EC4899',    // Creative pink
            accent: 'F59E0B',       // Creative orange
            highlight: '10B981',    // Fresh green
            text: '374151',         // Warm dark gray
            light: 'F3F4F6',       // Neutral light
            success: '059669',      // Success green
            warning: 'DC2626'       // Alert red
          },
          academic: {
            background: backgroundStyle === 'gradient' ? { type: 'linear', colors: ['FFFFFF', 'FAFBFC'] } : 'FFFFFF',
            primary: '1F2937',      // Academic dark gray
            secondary: '4B5563',    // Medium gray
            accent: '1D4ED8',       // Academic blue
            highlight: '7C2D12',    // Academic brown
            text: '374151',         // Text gray
            light: 'F9FAFB',       // Light background
            success: '047857',      // Academic green
            warning: 'B45309'       // Academic orange
          },
          business: {
            background: backgroundStyle === 'gradient' ? { type: 'linear', colors: ['FFFFFF', 'F8FAFC'] } : 'FFFFFF',
            primary: '0F172A',      // Corporate navy
            secondary: '334155',    // Corporate gray
            accent: '1E40AF',       // Corporate blue
            highlight: '059669',    // Corporate green
            text: '475569',         // Business text
            light: 'F1F5F9',       // Corporate light
            success: '047857',      // Success indicator
            warning: 'DC2626'       // Warning indicator
          }
        };
        
        const colors = colorSchemes[style];
        
        // Define advanced slide layouts and templates
        const slideLayouts = {
          title: {
            titleArea: { x: 0.5, y: 1.5, w: 9, h: 2 },
            subtitleArea: { x: 0.5, y: 4, w: 9, h: 1 },
            decorativeElements: true
          },
          content: {
            titleArea: { x: 0.5, y: 0.3, w: 9, h: 0.8 },
            contentArea: { x: 0.5, y: 1.5, w: 9, h: 5.5 },
            sidebarWidth: 0.15
          },
          twoColumn: {
            titleArea: { x: 0.5, y: 0.3, w: 9, h: 0.8 },
            leftColumn: { x: 0.5, y: 1.5, w: 4.25, h: 5.5 },
            rightColumn: { x: 5.25, y: 1.5, w: 4.25, h: 5.5 }
          },
          imageContent: {
            titleArea: { x: 0.5, y: 0.3, w: 9, h: 0.8 },
            imageArea: { x: 0.5, y: 1.5, w: 4.5, h: 3.5 },
            textArea: { x: 5.2, y: 1.5, w: 4.3, h: 5.5 }
          },
          conclusion: {
            titleArea: { x: 0.5, y: 2, w: 9, h: 1.5 },
            contentArea: { x: 0.5, y: 4, w: 9, h: 2.5 },
            emphasizeTitle: true
          }
        };
        
        // Professional typography settings
        const typography = {
          title: {
            fontSize: style === 'creative' ? 48 : 44,
            fontFace: style === 'academic' ? 'Times New Roman' : 'Calibri',
            bold: true,
            letterSpacing: style === 'business' ? 1 : 0
          },
          subtitle: {
            fontSize: 28,
            fontFace: style === 'academic' ? 'Times New Roman' : 'Calibri',
            bold: false,
            italic: style === 'academic'
          },
          heading: {
            fontSize: 36,
            fontFace: style === 'academic' ? 'Times New Roman' : 'Calibri',
            bold: true
          },
          body: {
            fontSize: 20,
            fontFace: style === 'academic' ? 'Times New Roman' : 'Calibri',
            lineSpacing: 1.4
          },
          caption: {
            fontSize: 14,
            fontFace: style === 'academic' ? 'Times New Roman' : 'Calibri',
            italic: true
          }
        };
        
        // Create professional title slide with advanced layout
        const titleSlide = pptx.addSlide();
        const titleLayout = slideLayouts.title;
        
        // Set sophisticated background
        if (typeof colors.background === 'object') {
          titleSlide.background = { fill: colors.background.colors[0] };
        } else {
          titleSlide.background = { color: colors.background };
        }
        
        // Add professional background elements
        if (backgroundStyle === 'pattern') {
          // Subtle geometric pattern
          for (let i = 0; i < 20; i++) {
            titleSlide.addShape(pptx.ShapeType.ellipse, {
              x: Math.random() * 10, y: Math.random() * 7.5, w: 0.1, h: 0.1,
              fill: { color: colors.light, transparency: 85 },
              line: { color: colors.accent, width: 0.5, transparency: 90 }
            });
          }
        } else if (backgroundStyle === 'gradient') {
          // Professional gradient overlay
          titleSlide.addShape(pptx.ShapeType.rect, {
            x: 0, y: 0, w: 10, h: 7.5,
            fill: { 
              type: 'gradient',
              colors: [
                { color: colors.light, position: 0, transparency: 95 },
                { color: colors.accent, position: 100, transparency: 98 }
              ],
              angle: 45
            },
            line: { width: 0 }
          });
        }
        
        // Add sophisticated header design element
        titleSlide.addShape(pptx.ShapeType.rect, {
          x: 0, y: 0, w: 10, h: 0.8,
          fill: { 
            type: 'gradient',
            colors: [
              { color: colors.primary, position: 0, transparency: 10 },
              { color: colors.accent, position: 100, transparency: 30 }
            ]
          },
          line: { width: 0 }
        });
        
        // Add main title with professional typography
        titleSlide.addText(title, {
          x: titleLayout.titleArea.x, y: titleLayout.titleArea.y, 
          w: titleLayout.titleArea.w, h: titleLayout.titleArea.h,
          fontSize: typography.title.fontSize, 
          fontFace: typography.title.fontFace, 
          color: colors.primary,
          bold: typography.title.bold, 
          align: 'center', valign: 'middle',
          shadow: { 
            type: 'outer', color: colors.accent, blur: 4, offset: 2, 
            angle: 45, transparency: 70 
          },
          letterSpacing: typography.title.letterSpacing || 0
        });
        
        // Add professional subtitle
        titleSlide.addText('AI-Generated Professional Presentation', {
          x: titleLayout.subtitleArea.x, y: titleLayout.subtitleArea.y,
          w: titleLayout.subtitleArea.w, h: titleLayout.subtitleArea.h,
          fontSize: typography.subtitle.fontSize, 
          fontFace: typography.subtitle.fontFace, 
          color: colors.secondary,
          bold: typography.subtitle.bold,
          italic: typography.subtitle.italic,
          align: 'center', valign: 'middle'
        });
        
        // Add sophisticated decorative elements
        if (titleLayout.decorativeElements) {
          // Professional accent line
          titleSlide.addShape(pptx.ShapeType.rect, {
            x: 2, y: 5.8, w: 6, h: 0.08,
            fill: { 
              type: 'gradient',
              colors: [
                { color: colors.highlight, position: 0 },
                { color: colors.accent, position: 50 },
                { color: colors.highlight, position: 100 }
              ]
            },
            line: { width: 0 }
          });
          
          // Corner design elements
          titleSlide.addShape(pptx.ShapeType.triangle, {
            x: 0.2, y: 0.2, w: 0.8, h: 0.8,
            fill: { color: colors.highlight, transparency: 80 },
            line: { color: colors.accent, width: 1, transparency: 60 }
          });
          
          titleSlide.addShape(pptx.ShapeType.triangle, {
            x: 9, y: 6.5, w: 0.8, h: 0.8,
            fill: { color: colors.accent, transparency: 80 },
            line: { color: colors.highlight, width: 1, transparency: 60 },
            rotate: 180
          });
        }
        
        // Add professional footer with branding
        titleSlide.addText('Powered by VOAI Assistant', {
          x: 0.5, y: 6.8, w: 9, h: 0.4,
          fontSize: typography.caption.fontSize, 
          fontFace: typography.caption.fontFace,
          color: colors.secondary, 
          italic: typography.caption.italic,
          align: 'center', transparency: 40
        });
        
        // Parse AI content and create enhanced slides
        const sections = content.split(/(?:Slide \d+:|##|\*\*Slide)/i).filter(section => section.trim());
        
        sections.forEach((section, index) => {
          if (index === 0 || !section.trim()) return; // Skip empty or title section
          
          const slide = pptx.addSlide();
          
          // Set background
          if (typeof colors.background === 'object') {
            slide.background = { fill: colors.background.colors[0] };
          } else {
            slide.background = { color: colors.background };
          }
          
          // Add background pattern if selected
          if (backgroundStyle === 'pattern') {
            slide.addShape(pptx.ShapeType.rect, {
              x: 0, y: 0, w: 10, h: 7.5,
              fill: { color: colors.light, transparency: 90 },
              line: { color: colors.accent, width: 0.3, dashType: 'dot' }
            });
          }
          
          // Extract slide title and content
          const lines = section.trim().split('\n').filter(line => line.trim());
          const slideTitle = lines[0]?.replace(/^\d+\.?\s*/, '').replace(/\*\*/g, '').trim() || `Slide ${index}`;
          const slideContent = lines.slice(1).join('\n').trim();
          
          // Add slide title with enhanced styling
          slide.addText(slideTitle, {
            x: 0.5, y: 0.5, w: 9, h: 1,
            fontSize: 32, fontFace: 'Arial', color: colors.primary,
            bold: true, align: 'left',
            shadow: { type: 'outer', color: '000000', blur: 2, offset: 1, angle: 45 }
          });
          
          // Add title underline with gradient effect
          slide.addShape(pptx.ShapeType.rect, {
            x: 0.5, y: 1.6, w: 9, h: 0.05,
            fill: { color: colors.accent }
          });
          
          // Process content into bullet points or paragraphs
          const contentLines = slideContent.split('\n').filter(line => line.trim());
          let yPosition = 2.2;
          
          contentLines.forEach((line, lineIndex) => {
            if (yPosition > 6.5) return; // Prevent overflow
            
            const cleanLine = line.replace(/^[-*]\s*/, '').trim();
            if (!cleanLine) return;
            
            // Determine if it's a bullet point
            const isBullet = /^[-*]\s*/.test(line);
            
            slide.addText(cleanLine, {
              x: isBullet ? 1 : 0.5,
              y: yPosition,
              w: isBullet ? 8.5 : 9,
              h: 0.6,
              fontSize: 18,
              fontFace: 'Arial',
              color: colors.text,
              align: 'left',
              bullet: isBullet ? { type: 'bullet', style: '', color: colors.accent } : false
            });
            
            yPosition += 0.7;
          });
          
          // Add slide number with styling
          slide.addText(`${index}`, {
            x: 9, y: 7, w: 0.5, h: 0.3,
            fontSize: 12, fontFace: 'Arial', color: colors.secondary,
            align: 'center'
          });
          
          // Add enhanced decorative elements based on slide content
          if (slideTitle.toLowerCase().includes('conclusion') || slideTitle.toLowerCase().includes('summary')) {
            // Add conclusion slide decoration
            slide.addShape(pptx.ShapeType.rect, {
              x: 0.2, y: 0.2, w: 0.3, h: 7.3,
              fill: { color: colors.accent, transparency: 20 },
              line: { color: colors.accent, width: 2 }
            });
          } else if (slideTitle.toLowerCase().includes('introduction') || index === 1) {
            // Add introduction slide decoration
            slide.addShape(pptx.ShapeType.ellipse, {
              x: 8.5, y: 6, w: 1, h: 1,
              fill: { color: colors.secondary, transparency: 70 },
              line: { color: colors.secondary, width: 2 }
            });
          }
          
          // Add side accent bar for visual interest
          slide.addShape(pptx.ShapeType.rect, {
            x: 0, y: 0, w: 0.1, h: 7.5,
            fill: { color: colors.accent }
          });
        });
        
        // Add enhanced final slide
        const finalSlide = pptx.addSlide();
        finalSlide.background = { 
          color: colors.primary
        };
        
        finalSlide.addText('Thank You!', {
          x: 0.5, y: 2.5, w: 9, h: 1.5,
          fontSize: 48, fontFace: 'Arial', color: 'FFFFFF',
          bold: true, align: 'center', valign: 'middle',
          shadow: { type: 'outer', color: '000000', blur: 5, offset: 3, angle: 45 }
        });
        
        finalSlide.addText('Questions & Discussion', {
          x: 0.5, y: 4.5, w: 9, h: 1,
          fontSize: 24, fontFace: 'Arial', color: 'FFFFFF',
          align: 'center', valign: 'middle'
        });
        
        // Add decorative elements to final slide
        finalSlide.addShape(pptx.ShapeType.ellipse, {
          x: 2, y: 1, w: 6, h: 0.3,
          fill: { color: colors.accent, transparency: 50 }
        });
        
        // Generate and download PPTX file
        const fileName = `${title.replace(/[^a-zA-Z0-9]/g, '_')}_presentation.pptx`;
        await pptx.writeFile({ fileName: fileName });
        
        // Show enhanced success message
        addBotMessage(` PowerPoint presentation "${title}" has been generated and downloaded as a PPTX file! 

Features included:
 ${style.charAt(0).toUpperCase() + style.slice(1)} styling with ${backgroundStyle} backgrounds
 ${animationStyle === 'none' ? 'Clean static design' : animationStyle.charAt(0).toUpperCase() + animationStyle.slice(1) + ' animations'}
 ${includeImages ? 'Image placeholders and suggestions' : 'Text-focused content'}
 Professional color scheme and typography
 Decorative elements and visual enhancements

The presentation is ready to use in PowerPoint, Google Slides, or any compatible presentation software!`);
        
      } catch (error) {
        console.error('PPTX Generation Error:', error);
        throw new Error(`Failed to create PPTX file: ${error.message}`);
      }
    }

    // Client-side Document Generation Functions
    async function generateDocument(button, format) {
      try {
        // Find the message content
        const messageElement = button.closest('.message');
        const messageContent = messageElement.querySelector('.message-bubble').innerText;
        
        // Extract a filename from the first line or use default
        const firstLine = messageContent.split('\n')[0];
        const fileName = firstLine.length > 50 ? 'AI_Response' : firstLine.replace(/[^a-zA-Z0-9]/g, '_');
        
        // Show loading state
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        button.disabled = true;
        
        let blob;
        let downloadFileName;
        
        if (format === 'pdf') {
          blob = await generatePDF(messageContent);
          downloadFileName = `${fileName}.pdf`;
        } else if (format === 'docx') {
          blob = await generateDOCX(messageContent);
          downloadFileName = `${fileName}.docx`;
        } else if (format === 'excel') {
          blob = await generateExcel(messageContent);
          downloadFileName = `${fileName}.xlsx`;
        }
        
        // Create download link
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = downloadFileName;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        // Show success message
        addBotMessage(` ${format.toUpperCase()} document generated and downloaded successfully!`);
        
      } catch (error) {
        console.error('Document generation error:', error);
        addBotMessage(` Error generating ${format.toUpperCase()} document: ${error.message}`);
      } finally {
        // Restore button state
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }

    // Generate PDF using jsPDF
    async function generatePDF(content) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Set font and size
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(12);
      
      // Split content into lines that fit the page width
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 20;
      const maxLineWidth = pageWidth - 2 * margin;
      
      const lines = doc.splitTextToSize(content, maxLineWidth);
      
      let y = margin;
      const lineHeight = 7;
      const pageHeight = doc.internal.pageSize.getHeight();
      
      for (let i = 0; i < lines.length; i++) {
        if (y + lineHeight > pageHeight - margin) {
          doc.addPage();
          y = margin;
        }
        doc.text(lines[i], margin, y);
        y += lineHeight;
      }
      
      return doc.output('blob');
    }

    // Generate DOCX using docx library
    async function generateDOCX(content) {
      try {
        // Check if docx library is available
        if (typeof docx === 'undefined') {
          throw new Error('DOCX library not loaded');
        }
        
        const { Document, Packer, Paragraph, TextRun } = docx;
        
        // Split content into paragraphs
        const paragraphs = content.split('\n').map(line => 
          new Paragraph({
            children: [new TextRun(line || ' ')], // Empty line if no content
          })
        );
        
        const doc = new Document({
          sections: [{
            properties: {},
            children: paragraphs,
          }],
        });
        
        return await Packer.toBlob(doc);
      } catch (error) {
        console.error('DOCX generation error:', error);
        // Fallback: create a simple text file with .docx extension
        const blob = new Blob([content], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
        return blob;
      }
    }

    // Generate Excel using xlsx library
    async function generateExcel(content) {
      const wb = XLSX.utils.book_new();
      
      // Split content into lines and create worksheet data
      const lines = content.split('\n');
      const wsData = lines.map((line, index) => ({
        'Line': index + 1,
        'Content': line
      }));
      
      const ws = XLSX.utils.json_to_sheet(wsData);
      
      // Set column widths
      ws['!cols'] = [
        { width: 10 },  // Line number column
        { width: 100 }  // Content column
      ];
      
      XLSX.utils.book_append_sheet(wb, ws, 'AI Response');
      
      return new Promise((resolve) => {
        XLSX.writeFile(wb, 'temp.xlsx', { 
          bookType: 'xlsx', 
          type: 'binary',
          cellStyles: true 
        });
        
        // Convert to blob
        const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
        resolve(new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }));
      });
    }
    const sentences = [
      "Whats on your mind today?",
      "Where should we begin?",
      "Ready when you are.",
      "What are you working on?",
      "Welcome back!"
    ];

    const random = Math.floor(Math.random() * sentences.length);
    document.getElementById("title").textContent = sentences[random];
"img2url\index.html"
"Feedback\index.html"
  </script>
 
 <script>
fetch('/api/me')
  .then(r=>r.json())
  .then(u=>{
    if (u.plan === "pro") location.href = "pro.html";
  });
</script>


</body>
</html>



